
 make.py started: 2020-09-24 19:25:40 /Users/gabriborg/Dropbox (Brown)/research/min_wage_rent/analysis/first_differences/code 




Execute:  stataSE -e do "./preclean.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

120-user Stata network perpetual license:
       Serial number:  401606201670
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./preclean.do 

. clear all

. set more off

. adopath + ../../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/gabriborg/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/gabriborg/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../../lib/stata/gslab_misc/ado"

. set maxvar 32000 


. 
. program main
  1.         local instub "../../../drive/derived_large/output"
  2.         local outstub "../temp"
  3.         local logfile "../output/data_file_manifest.log"
  4. 
. 
.         use "`instub'/baseline_rent_panel.dta", clear
  5.         keep zipcode place_code msa countyfips statefips                               
>                                  ///
>                 year_month calendar_month trend trend_sq trend_cu                         
>                               ///
>                 dactual_mw actual_mw medrentpricepsqft_*                                  
>                       ///
>                 med_hhinc20105 renthouse_share2010 white_share2010 black_share2010        
>               ///
>                 college_share20105 work_county_share20105
  6.         
. 
.         local het_vars "med_hhinc20105 renthouse_share2010 college_share20105 black_share2
> 010"
  7.         local het_vars "`het_vars' nonwhite_share2010 work_county_share20105"
  8. 
.         create_vars,    log_vars(actual_mw medrentpricepsqft_sfcc medrentpricepsqft_2br me
> drentpricepsqft_mfr5plus)     ///
>                                         heterogeneity_vars(`het_vars')
  9.         
.         simplify_varnames
 10. 
.         xtset zipcode year_month
 11.         gen d_ln_mw = D.ln_mw
 12. 
.         save_data "`outstub'/fd_rent_panel.dta", key(zipcode year_month) replace log(`logf
> ile')
 13. 
.         use zipcode place_code msa countyfips statefips                                   
>                               ///
>                 year_month calendar_month trend trend_sq trend_cu                         
>                               ///
>                 dactual_mw actual_mw medrentpricepsqft_*                                  
>                       ///
>                 med_hhinc20105 renthouse_share2010 white_share2010 black_share2010        
>               ///
>                 college_share20105 work_county_share20105 entry* using `instub'/unbal_rent
> _panel.dta, clear 
 14. 
.         local het_vars "med_hhinc20105 renthouse_share2010 college_share20105 black_share2
> 010"
 15.         local het_vars "`het_vars' nonwhite_share2010 work_county_share20105"
 16. 
.         create_vars,    log_vars(actual_mw medrentpricepsqft_sfcc medrentpricepsqft_2br me
> drentpricepsqft_mfr5plus)     ///
>                                         heterogeneity_vars(no)
 17.         
.         simplify_varnames
 18. 
.         xtset zipcode year_month
 19.         gen d_ln_mw = D.ln_mw
 20. 
.         save_data "`outstub'/unbal_fd_rent_panel.dta", key(zipcode year_month) replace log
> (`logfile')
 21. 
. 
.         
. 
. 
. end

. 
. program create_vars
  1.         syntax, log_vars(str) heterogeneity_vars(str)
  2. 
.         foreach var in `log_vars' {
  3.                 gen ln_`var' = ln(`var')
  4.         }
  5. 
.         gen nonwhite_share2010 = 1 - white_share2010
  6.         
.         gen trend_times2 = 2*trend
  7. 
.         if "`heterogeneity_vars'"!="no" {
  8.                 foreach var in `heterogeneity_vars' {
  9.                         *xtile `var'_nat_dec = `var', nq(10)
.                         xtile `var'_nat_qtl = `var', nq(4)
 10.                         levelsof statefips, local(states)
 11. 
.                         foreach state in `states'{
 12.                                 *xtile deciles_`state'_`var' = `var' if statefips == `s
> tate', nq(10)
.                                 xtile qtiles_`state'_`var' = `var' if statefips == `state'
> , nq(4)
 13.                         }
 14.                         *egen `var'_st_dec = rowtotal(deciles_*)
.                         egen `var'_st_qtl = rowtotal(qtiles_*)
 15.                         
.                         *drop deciles_* qtiles_*
.                         drop qtiles_*
 16.                 }               
 17.         } 
 18. end

. 
. program simplify_varnames
  1.         
.     rename      (ln_actual_mw   ln_medrentpricepsqft_sfcc ln_medrentpricepsqft_2br ln_medr
> entpricepsqft_mfr5plus)               ///
>                 (ln_mw                  ln_med_rent_psqft_sfcc ln_med_rent_psqft_2br ln_me
> d_rent_psqft_mfr5plus)
  2. 
. end

. 
. main
(43,225 missing values generated)
(131,811 missing values generated)
(119,012 missing values generated)
1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 24 25 26 27 28 29 32 34 35 36 37 39 40 41 42 
> 44 45 47 48 49 51 53 54 56
1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 24 25 26 27 28 29 32 34 35 36 37 39 40 41 42 
> 44 45 47 48 49 51 53 54 56
1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 24 25 26 27 28 29 32 34 35 36 37 39 40 41 42 
> 44 45 47 48 49 51 53 54 56
1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 24 25 26 27 28 29 32 34 35 36 37 39 40 41 42 
> 44 45 47 48 49 51 53 54 56
1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 24 25 26 27 28 29 32 34 35 36 37 39 40 41 42 
> 44 45 47 48 49 51 53 54 56
1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 24 25 26 27 28 29 32 34 35 36 37 39 40 41 42 
> 44 45 47 48 49 51 53 54 56
       panel variable:  zipcode (strongly balanced)
        time variable:  year_month, 2010m1 to 2019m12
                delta:  1 month
(1,305 missing values generated)
(data already sorted by zipcode year_month)
  variable trend_times2 was float now int
  variable med_hhinc20105_st_qtl was float now byte
  variable renthouse_share2010_st_qtl was float now byte
  variable college_share20105_st_qtl was float now byte
  variable black_share2010_st_qtl was float now byte
  variable nonwhite_share2010_st_qtl was float now byte
  variable work_county_share20105_st_qtl was float now byte
  (3,132,000 bytes saved)
============================================================================
File: ../temp/fd_rent_panel.dta
Key: zipcode year_month
============================================================================
  156600:40(73724):498492281:1547141

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     zipcode |    156,600    51920.57    29185.78       2113      99577
  year_month |    156,600       659.5    34.63992        600        719
  place_code |    129,840    40657.65    22564.03        410      87240
  countyfips |    156,240    24077.04    16484.28       1003      56021
   statefips |    156,600    23.97854    16.42626          1         56
-------------+---------------------------------------------------------
   actual_mw |    156,600     8.07779    1.207718       7.25         16
  dactual_mw |    156,600    .0152048    .1121804          0       2.21
calendar_m~h |    156,600         6.5    3.452064          1         12
         msa |    156,600    436.1801    240.1675         12        860
       trend |    156,600       225.5    34.63992        166        285
-------------+---------------------------------------------------------
    trend_sq |    156,600    52050.17    15659.42      27556      81225
    trend_cu |    156,600    1.23e+07     5408203    4574296   2.31e+07
medrentpri~c |    113,375    1.188344    .7824813   .4180214   6.731387
medrentpri~r |     24,789     1.84165    .9184999   .5015197   6.499599
medrentpri~s |     37,588    1.842276    1.001968   .5106889    6.48415
-------------+---------------------------------------------------------
white_s~2010 |    156,600    .5392018    .2225559   .0037838   .9401773
black_s~2010 |    156,600     .165993    .2003044    .003148   .9753076
renthou~2010 |    156,600    .3834818     .176359   .0644567   .9662035
work_c~20105 |    156,600    .7557563    .2036341   .1421741    .995271
colleg~20105 |    156,600    .4447718    .1662964   .0856991   .9082218
-------------+---------------------------------------------------------
med_hh~20105 |    156,600    66919.72    24575.33   20527.66   191553.2
       ln_mw |    156,600    2.079602    .1327775   1.981001   2.772589
ln_med_ren~c |    113,375    .0472541    .4493362  -.8722228   1.906781
ln_med_ren~r |     24,789    .5040377    .4535385  -.6901123    1.87174
ln_med_ren~s |     37,588    .4931396     .468299  -.6719947   1.869361
-------------+---------------------------------------------------------
nonwhit~2010 |    156,600    .4607982    .2225559   .0598227   .9962162
trend_times2 |    156,600         451    69.27985        332        570
med_h~at_qtl |    156,600    2.498851     1.11838          1          4
med_h~st_qtl |    156,600    2.467433    1.120644          1          4
renth~at_qtl |    156,600    2.498851     1.11838          1          4
-------------+---------------------------------------------------------
renth~st_qtl |    156,600    2.467433    1.120644          1          4
colle~at_qtl |    156,600    2.498851     1.11838          1          4
colle~st_qtl |    156,600    2.467433    1.120644          1          4
black~at_qtl |    156,600    2.498851     1.11838          1          4
black~st_qtl |    156,600    2.467433    1.120644          1          4
-------------+---------------------------------------------------------
nonwh~at_qtl |    156,600    2.498851     1.11838          1          4
nonwh~st_qtl |    156,600    2.467433    1.120644          1          4
work_~at_qtl |    156,600    2.498851     1.11838          1          4
work_~st_qtl |    156,600    2.467433    1.120644          1          4
     d_ln_mw |    155,295    .0016445    .0119584   -.290338   .2412503




(note: file ../temp/fd_rent_panel.dta not found)
file ../temp/fd_rent_panel.dta saved
(354,499 missing values generated)
(459,685 missing values generated)
(405,619 missing values generated)
(480 missing values generated)
       panel variable:  zipcode (unbalanced)
        time variable:  year_month, 2010m1 to 2019m12
                delta:  1 month
(4,604 missing values generated)
(data already sorted by zipcode year_month)
  variable trend_times2 was float now int
  (1,104,954 bytes saved)
============================================================================
File: ../temp/unbal_fd_rent_panel.dta
Key: zipcode year_month
============================================================================
  552477:31(42672):4288332768:4210029150

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     zipcode |    552,477    53537.25    30554.29       1060      99705
  year_month |    552,477    659.5003    34.63966        600        719
  place_code |    453,837    41994.73    23168.35        100      88940
  countyfips |    551,157    25881.72    16485.24       1001      56021
   statefips |    552,477    25.79028    16.43845          1         56
-------------+---------------------------------------------------------
medrentpri~r |     92,792    1.682865     .803698   .5015197   12.55461
medrentpri~c |    197,978    1.303812    1.033133   .1091193   23.96932
medrentpri~s |    146,858    1.736677     .849114   .3150482   12.55435
   actual_mw |    552,477    8.200625     1.36035       7.25         16
  dactual_mw |    552,473     .017035    .1206529          0       3.25
-------------+---------------------------------------------------------
calendar_m~h |    552,477     6.50003    3.452041          1         12
         msa |    552,357    442.6709     239.245          2        860
       trend |    552,477    225.5003    34.63966        166        285
    trend_sq |    552,477     52050.3    15659.32      27556      81225
    trend_cu |    552,477    1.23e+07     5408175    4574296   2.31e+07
-------------+---------------------------------------------------------
  entry_sfcc |    397,920    660.2961    34.20743        601        708
   entry_2br |    286,919    681.1911    24.64555        601        708
entry_mfr5~s |    403,797    676.3571    27.37039        601        708
white_s~2010 |    551,997     .589158    .2409829   .0037838   .9748839
black_s~2010 |    551,997    .1447029     .191157   .0009378   .9753076
-------------+---------------------------------------------------------
renthou~2010 |    551,997    .4013557    .1759362   .0608285   .9884645
work_c~20105 |    551,997     .755335    .1942749   .1248519    .998565
colleg~20105 |    551,997    .4360505    .1674601   .0580171   .9082218
med_hh~20105 |    551,997    64289.41    25477.42   12404.68   214212.3
       ln_mw |    552,477    2.092554    .1468084   1.981001   2.772589
-------------+---------------------------------------------------------
ln_med_ren~c |    197,978    .1260564    .4678614  -2.215314   3.176775
ln_med_ren~r |     92,792    .4297764    .4123671  -.6901123   2.530088
ln_med_ren~s |    146,858    .4566693     .422476   -1.15503   2.530067
nonwhit~2010 |    551,997     .410842    .2409829   .0251161   .9962162
trend_times2 |    552,477    451.0006    69.27932        332        570
-------------+---------------------------------------------------------
     d_ln_mw |    547,873    .0017993    .0125654   -.331534   .3083012




(note: file ../temp/unbal_fd_rent_panel.dta not found)
file ../temp/unbal_fd_rent_panel.dta saved

. 
end of do-file


Execute:  stataSE -e do "./first_differences.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

120-user Stata network perpetual license:
       Serial number:  401606201670
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./first_differences.do 

. clear all

. set more off

. adopath + ../../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/gabriborg/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/gabriborg/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../../lib/stata/gslab_misc/ado"

. adopath + ../../../lib/stata/min_wage/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/gabriborg/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/gabriborg/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../../lib/stata/gslab_misc/ado"
  [8]              "../../../lib/stata/min_wage/ado"

. set maxvar 32000 


. 
. program main
  1.         local instub "../temp"
  2.         local outstub "../output"
  3. 
.         local housetype "sfcc 2br mfr5plus"
  4. 
.         foreach type in `housetype' {
  5. 
.                 ** Balanced panel
.                 use "`instub'/fd_rent_panel.dta", clear
  6.                 * Static Model
.                 run_static_model, depvar(ln_med_rent_psqft_`type') absorb(year_month)     
>                                       ///
>                         cluster(statefips)
  7. 
.                 esttab * using "`outstub'/fd_table_`type'.tex", keep(D.ln_mw) compress se 
> replace                       ///
>                         stats(zs_trend zs_trend_sq r2 N, fmt(%s3 %s3 %9.3f %9.0g)         
>       ///
>                         labels("Zipcode-specifc linear trend"                             
>                                                       ///
>                         "Zipcode-specific linear and square trend"                        
>                                       ///
>                         "R-squared" "Observations")) star(* 0.10 ** 0.05 *** 0.01)        
>                                       ///
>                         nonote
  8.                 
.                 * Dynamic Model
.                 run_dynamic_model, depvar(ln_med_rent_psqft_`type') absorb(year_month)    
>                               ///
>                         cluster(statefips) type(`type') sampl(bal)
  9.                 
.                 esttab reg1 reg2 reg3 using "`outstub'/fd_dynamic_table_`type'.tex",      
>                               ///
>                         keep(*.ln_mw) compress se replace                                 
>                                                               ///
>                         stats(p_value_F zs_trend zs_trend_sq r2 N, fmt(%9.3f %s3 %s3 %9.3f
>  %9.0g)               ///
>                         labels("P-value no pretrends" "Zipcode-specifc linear trend"      
>                                                                               ///
>                         "Zipcode-specific linear and square trend"                        
>                                       ///
>                         "R-squared" "Observations")) star(* 0.10 ** 0.05 *** 0.01)        
>                                       ///
>                         nonote
 10. 
.                 esttab lincom1 lincom2 lincom3 using "`outstub'/fd_dynamic_lincom_table_`t
> ype'.tex", ///
>                         compress se replace                                               
>                                                                       ///
>                 stats(zs_trend zs_trend_sq N, fmt(%s3 %s3 %9.0g)                          
>       ///
>                         labels("Zipcode-specifc linear trend"                             
>                                                       ///
>                     "Zipcode-specific linear and square trend" ///
>                         "Observations"))                                ///
>                         star(* 0.10 ** 0.05 *** 0.01)                                     
>                                                               ///
>                         nonote coeflabel((1) "Sum of MW effects")
 11.          
.                 * Heterogeneity
.                 foreach var in med_hhinc20105 renthouse_share2010 college_share20105      
>                       ///
>                                         black_share2010 {
 12. 
.                         build_ytitle, var(`var')
 13. 
.                         run_static_heterogeneity, depvar(ln_med_rent_psqft_`type') absorb(
> year_month)                   ///
>                                 het_var(`var'_st_qtl) cluster(statefips) ytitle(`r(title)'
> )
 14.                         graph export "`outstub'/fd_static_`type'_heter_`var'.png", repl
> ace
 15.                 }
 16. 
.                 ** Unbalanced Panel 
.                 use "`instub'/unbal_fd_rent_panel.dta", clear
 17.                 
.                 * Static Model
.                 run_static_model, depvar(ln_med_rent_psqft_`type') absorb(year_month entry
> _`type'#year_month)                                           ///
>                         cluster(statefips)
 18. 
.                 esttab * using "`outstub'/unb_fd_table_`type'.tex", keep(D.ln_mw) compress
>  se replace                   ///
>                         stats(zs_trend zs_trend_sq r2 N, fmt(%s3 %s3 %9.3f %9.0g)         
>       ///
>                         labels("Zipcode-specifc linear trend"                             
>                                                       ///
>                         "Zipcode-specific linear and square trend"                        
>                                       ///
>                         "R-squared" "Observations")) star(* 0.10 ** 0.05 *** 0.01)        
>                                       ///
>                         nonote
 19.                 
.                 * Dynamic Model
.                 run_dynamic_model, depvar(ln_med_rent_psqft_`type') absorb(year_month entr
> y_`type'#year_month)                                  ///
>                         cluster(statefips) type(`type') sampl(unbal)
 20.                 
.                 esttab reg1 reg2 reg3 using "`outstub'/unb_fd_dynamic_table_`type'.tex",  
>                                       ///
>                         keep(*.ln_mw) compress se replace                                 
>                                                               ///
>                         stats(p_value_F zs_trend zs_trend_sq r2 N, fmt(%9.3f %s3 %s3 %9.3f
>  %9.0g)               ///
>                         labels("P-value no pretrends" "Zipcode-specifc linear trend"      
>                                                                               ///
>                         "Zipcode-specific linear and square trend"                        
>                                       ///
>                         "R-squared" "Observations")) star(* 0.10 ** 0.05 *** 0.01)        
>                                       ///
>                         nonote
 21. 
.                 esttab lincom1 lincom2 lincom3 using "`outstub'/unb_fd_dynamic_lincom_tabl
> e_`type'.tex", ///
>                         compress se replace                                               
>                                                                       ///
>                 stats(zs_trend zs_trend_sq N, fmt(%s3 %s3 %9.0g)                          
>       ///
>                         labels("Zipcode-specifc linear trend"                             
>                                                       ///
>                     "Zipcode-specific linear and square trend" ///
>                         "Observations"))                                ///
>                         star(* 0.10 ** 0.05 *** 0.01)                                     
>                                                               ///
>                         nonote coeflabel((1) "Sum of MW effects")
 22. 
.         }
 23. end

. 
. program run_static_model
  1.     syntax, depvar(str) absorb(str) cluster(str)
  2. 
.         eststo clear
  3.         eststo: reghdfe D.`depvar' D.ln_mw,                                            
>          ///
>                 absorb(`absorb')                                                          
>                                       ///
>                 vce(cluster `cluster') nocons
  4.         comment_table, trend_lin("No") trend_sq("No")
  5.         distinct zipcode if e(sample)==1
  6. STOP
  7.         scalar static_effect = _b[D.ln_mw]
  8.         scalar static_effect_se = _se[D.ln_mw]
  9. 
.         eststo: reghdfe D.`depvar' D.ln_mw,                                               
>                       ///
>                 absorb(`absorb' i.zipcode)                                                
>               ///
>                 vce(cluster `cluster') nocons
 10.         comment_table, trend_lin("Yes") trend_sq("No")
 11. 
.         eststo: reghdfe D.`depvar' D.ln_mw,                                               
>                       ///
>                 absorb(`absorb' i.zipcode c.trend_times2#i.zipcode)             ///
>                 vce(cluster `cluster') nocons
 12.         comment_table, trend_lin("Yes") trend_sq("Yes")
 13. end

. 
. program run_dynamic_model
  1.         syntax, depvar(str) absorb(str) cluster(str) type(str) sampl(str) [w(int 5)]
  2.         
.         local lincomest_coeffs "D1.ln_mw + LD.ln_mw"
  3.         forvalues i = 2(1)`w'{
  4.                 local lincomest_coeffs "`lincomest_coeffs' + L`i'D.ln_mw"
  5.         }
  6. 
.         eststo clear
  7.         eststo reg1: reghdfe D.`depvar' L(-`w'/`w').D.ln_mw,                    ///
>                 absorb(`absorb')                                                          
>                               ///
>                 vce(cluster `cluster') nocons
  8.         comment_table, trend_lin("No") trend_sq("No")
  9.         
.         test (F5D.ln_mw = 0) (F4D.ln_mw = 0) (F3D.ln_mw = 0) (F2D.ln_mw = 0) (F1D.ln_mw = 
> 0)
 10.     estadd scalar p_value_F = r(p)
 11. 
.         preserve
 12.                 coefplot, vertical base gen
 13.                 keep __at __b __se
 14.                 rename (__at __b __se) (at b_full se_full)
 15.                 
.                 keep if !missing(at)
 16. 
.                 gen b_full_lb = b_full - 1.96*se_full
 17.                 gen b_full_ub = b_full + 1.96*se_full
 18.                 
.                 gen static_path = 0 if at <= `w' 
 19.                 replace static_path = scalar(static_effect) if at > `w'
 20.                 gen static_path_lb = 0 if at <= `w'
 21.                 replace static_path_lb = scalar(static_effect) - 1.96*scalar(static_eff
> ect_se) if at > `w'
 22.                 gen static_path_ub = 0 if at <= `w'
 23.                 replace static_path_ub = scalar(static_effect) + 1.96*scalar(static_eff
> ect_se) if at > `w'
 24.                 
.                 save "../temp/plot_coeffs.dta", replace
 25.     restore
 26.                 
.         eststo lincom1: lincomest `lincomest_coeffs'
 27.         comment_table, trend_lin("No") trend_sq("No")
 28.                         
.         qui reghdfe D.`depvar' L(0/`w').D.ln_mw,                        ///
>                 absorb(`absorb')                                                          
>                               ///
>                 vce(cluster `cluster') nocons
 29.                         
.         preserve
 30.                 coefplot, vertical base gen
 31.                 keep __at __b __se
 32.                 rename (__at __b __se) (at b_lags se_lags)
 33.                 tset at
 34. 
.             keep if !missing(at)
 35. 
.                 gen b_lags_lb = b_lags - 1.96*se_lags
 36.                 gen b_lags_ub = b_lags + 1.96*se_lags
 37.                 
.                 gen cumsum_b_lags = b_lags[1]
 38.                 replace cumsum_b_lags = cumsum_b_lags[_n-1] + b_lags[_n] if _n > 1
 39.                 
.                 replace at = at + `w'
 40.                 
.                 merge 1:1 at using "../temp/plot_coeffs.dta", nogen
 41.                 replace cumsum_b_lags = 0 if at <= `w'
 42.                 sort at
 43.                 
.                 // To avoid the lines overlapping perfectly
.                 gen at_full = at - 0.09
 44.                 gen at_lags = at + 0.09
 45.                 replace at_full = at if _n <= `w'
 46.                 replace at_lags = at if _n <= `w'
 47. 
.                 replace cumsum_b_lags = cumsum_b_lags - 0.00007 if _n <= `w'
 48.                 replace static_path = static_path + 0.00007 if _n <= `w'
 49. 
.                 // Figure
.                 twoway (scatter b_full at_full, mcol(navy))                             //
> /
>                         (rcap b_full_lb b_full_ub at_full, col(navy))                   //
> /
>                         (scatter b_lags at_lags, mcol(maroon))                            
>       ///
>                         (rcap b_lags_lb b_lags_ub at_lags, col(maroon))                 //
> /
>                         (line static_path at, lcol(gs4) lpat(dash))                     //
> /
>                         (line cumsum_b_lags at, lcol(maroon)),                            
>       ///
>                         yline(0, lcol(grey) lpat(dot))                                    
>               ///
>                         graphregion(color(white)) bgcolor(white)                          
>       ///
>                         xlabel(1 "F5D.ln_mw" 2 "F4D.ln_mw" 3 "F3D.ln_mw" 4 "F2D.ln_mw" ///
>                         5 "FD.ln_mw" 6 "D.ln_mw" 7 "LD.ln_mw" 8 "L2D.ln_mw" 9 "L3D.ln_mw" 
> ///
>                         10 "L4D.ln_mw" 11 "L5D.ln_mw", labsize(vsmall)) xtitle("Leads and 
> lags of ln MW") ///
>                         ytitle("Effect on ln rent per sqft")                              
>       ///
>                         legend(order(1 "Full dynamic model" 3 "Distributed lags model" ///
>                         5 "Effects path static model" 6 "Effects path distributed lags mod
> el") size(small))
 50.                 if "`sampl'"=="bal" {
 51.                         graph export "../output/fd_models_`type'.png", replace
 52.                 }
 53.                 else if "`sampl'"=="unbal" {
 54.                         graph export "../output/unb_fd_models_`type'.png", replace     
>  
 55.                 }
 56.         restore 
 57.         
.         eststo reg2: reghdfe D.`depvar' L(-`w'/`w').D.ln_mw  `if',              ///
>                 absorb(`absorb' i.zipcode)                                                
>       ///
>                 vce(cluster `cluster') nocons
 58.         comment_table, trend_lin("Yes") trend_sq("No")
 59.         
.         test (F5D.ln_mw = 0) (F4D.ln_mw = 0) (F3D.ln_mw = 0) (F2D.ln_mw = 0) (F1D.ln_mw = 
> 0)
 60.     estadd scalar p_value_F = r(p)
 61.         
.         eststo lincom2: lincomest `lincomest_coeffs'
 62.         comment_table, trend_lin("Yes") trend_sq("No")
 63.         
.         eststo reg3: reghdfe D.`depvar' L(-`w'/`w').D.ln_mw `if',               ///
>                 absorb(`absorb' i.zipcod c.trend_times2#i.zipcode)      ///
>                 vce(cluster `cluster') nocons
 64.         comment_table, trend_lin("Yes") trend_sq("Yes")
 65. 
.         test (F5D.ln_mw = 0) (F4D.ln_mw = 0) (F3D.ln_mw = 0) (F2D.ln_mw = 0) (F1D.ln_mw = 
> 0)
 66.     estadd scalar p_value_F = r(p)
 67.         
.         eststo lincom3: lincomest `lincomest_coeffs'
 68.         comment_table, trend_lin("Yes") trend_sq("Yes")
 69. end

. 
. program run_static_heterogeneity
  1.         syntax, depvar(str) absorb(str) cluster(str) het_var(str) ytitle(str) [qtles(in
> t 5)]
  2. 
.     eststo clear
  3.         reghdfe D.`depvar' c.d_ln_mw#i.`het_var',                                      
>                  ///
>                 absorb(`absorb') ///
>                 vce(cluster `cluster') nocons
  4. 
.         coefplot, base graphregion(color(white)) bgcolor(white)                           
>               ///
>         ylabel(1 "1" 2 "2" 3 "3" 4 "4" 5 "5")                                             
>       ///
>         ytitle(`ytitle')                                                                  
>                               ///
>         xtitle("Estimated effect of ln MW on ln rents")                                 //
> /
>         xline(0, lcol(grey) lpat(dot))
  5. end

. 
. program build_ytitle, rclass
  1.         syntax, var(str)
  2. 
.         if "`var'" == "med_hhinc20105" {
  3.                 return local title "Quintiles of within state 2010 median household inc
> ome"
  4.         }
  5.         if "`var'" == "renthouse_share2010" {
  6.                 return local title "Quintiles of 2010 share of houses rent"
  7.         }
  8.         if "`var'" == "college_share20105" {
  9.                 return local title "Quintiles of 2010 college share"
 10.         }
 11.         if "`var'" == "black_share2010" {
 12.                 return local title "Quintiles of 2010 share of black individuals"
 13.         }
 14.         if "`var'" == "nonwhite_share2010" {
 15.                 return local title "Quintiles of 2010 share of non-white individuals"
 16.         }
 17.         if "`var'" == "work_county_share20105" {
 18.                 return local title "Quintiles of 2010 share who work in county"
 19.         }                 
 20. end

. 
. program comment_table
  1.         syntax, trend_lin(str) trend_sq(str)
  2. 
.         estadd local zs_trend           "`trend_lin'"   
  3.         estadd local zs_trend_sq        "`trend_sq'"
  4. end

. 
. main
(MWFE estimator converged in 1 iterations)

HDFE Linear regression                            Number of obs   =    112,232
Absorbing 1 HDFE group                            F(   1,     40) =       4.13
Statistics robust to heteroskedasticity           Prob > F        =     0.0488
                                                  R-squared       =     0.0218
                                                  Adj R-squared   =     0.0208
                                                  Within R-sq.    =     0.0001
Number of clusters (statefips) =         41       Root MSE        =     0.0279

                             (Std. Err. adjusted for 41 clusters in statefips)
------------------------------------------------------------------------------
D.           |               Robust
ln_med_ren~c |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       ln_mw |
         D1. |   .0260395   .0128154     2.03   0.049     .0001386    .0519404
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
  year_month |       118           0         118     |
-----------------------------------------------------+
(est1 stored)

added macro:
           e(zs_trend) : "No"

added macro:
        e(zs_trend_sq) : "No"

         |        Observations
         |      total   distinct
---------+----------------------
 zipcode |     112232       1143
command STOP is unrecognized
r(199);

end of do-file
r(199);

 make.py ended: 2020-09-24 19:27:24
