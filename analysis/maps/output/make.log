
 make.py started: 2021-09-15 14:59:32 C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\code 




Execute:  R CMD BATCH --no-save "./plot_descriptive_maps.R" plot_descriptive_maps.Rout

R version 4.0.3 (2020-10-10) -- "Bunny-Wunnies Freak Out"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> remove(list = ls())
> 
> library(sf)
Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
Warning message:
package 'sf' was built under R version 4.0.5 
> library(data.table)
> library(dplyr)

Attaching package: 'dplyr'

The following objects are masked from 'package:data.table':

    between, first, last

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

> library(spData)
> library(tmap)
Warning message:
package 'tmap' was built under R version 4.0.5 
> library(tmaptools)
Warning message:
package 'tmaptools' was built under R version 4.0.5 
> library(leaflet)
Warning message:
package 'leaflet' was built under R version 4.0.5 
> library(ggplot2)
> 
> USPS_zipcodes <- read_sf(dsn = "../../../drive/raw_data/shapefiles/USPS_zipcodes", 
+                          layer = "USPS_zipcodes_July2020")
> USPS_zipcodes <- USPS_zipcodes %>%
+   select(ZIP_CODE, PO_NAME, STATE, POPULATION, SQMI, POP_SQMI) %>%
+   rename(zipcode = ZIP_CODE, zipcode_name = PO_NAME,
+          state_name = STATE, pop2020 = POPULATION, 
+          area_sq_miles = SQMI, pop2020_per_sq_miles = POP_SQMI)
> 
> zipcodes <- fread("../../../drive/derived_large/zipcode/zipcode_cross.csv",
+                     colClasses = c(zipcode ="character", place_code ="character", 
+                                    countyfips = "character", cbsa10 = "character",
+                                    zcta ="character", place_name = "character", 
+                                    county_name = "character", cbsa10_name = "character",
+                                    state_abb = "character", statefips = "character"))
> merged <- left_join(USPS_zipcodes, zipcodes, by = "zipcode") %>%
+   filter(is.na(area_sq_miles) == FALSE) %>%
+   mutate(in_zillow = case_when(n_months_zillow_rents > 0 ~ 1,
+                                TRUE ~ 0))
> 
> matched <- merged %>%
+   filter(is.na(houses_zcta_place_county) == FALSE)
> 
> merged_for_maps <- merged %>%
+   filter(state_abb != "AK" & state_abb != "HI")
> 
> # test <- merged_for_maps%>%
> #   filter(state_abb == "NY")
> 
> USPS_zipcodes_density_map <- tm_shape(merged_for_maps) + 
+   tm_fill(col = "pop2020_per_sq_miles",
+           title = "Population density",
+           style = "quantile",
+           n = 10,
+           palette = "Reds") +
+   tm_borders(lwd = .0001, alpha = 0.1) +
+   tmap_mode("plot") + tmap_options(check.and.fix = TRUE)
tmap mode set to plotting
> USPS_zipcodes_density_map
Warning message:
The shape merged_for_maps is invalid. See sf::st_is_valid 
> tmap_save(USPS_zipcodes_density_map, 
+           "../output/USPS_zipcodes_pop_density.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\USPS_zipcodes_pop_density.png
Resolution: 954.1991 by 513.5196 pixels
Size: 9.541991 by 5.135196 inches (100 dpi)
Warning messages:
1: The shape merged_for_maps is invalid. See sf::st_is_valid 
2: The shape merged_for_maps is invalid. See sf::st_is_valid 
> 
> USPS_zipcodes_zillow_data <- tm_shape(merged_for_maps) + 
+   tm_fill(col = "in_zillow",
+           title = "Has Zillow rents data",
+           style ="cat", 
+           palette = "BuGn") +
+   tm_borders(lwd = .0001, alpha = 0.1) +
+   tmap_mode("plot") + tmap_options(check.and.fix = TRUE)
tmap mode set to plotting
> USPS_zipcodes_zillow_data
Warning message:
The shape merged_for_maps is invalid. See sf::st_is_valid 
> tmap_save(USPS_zipcodes_zillow_data, 
+           "../output/USPS_zipcodes_zillow_data.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\USPS_zipcodes_zillow_data.png
Resolution: 954.1991 by 513.5196 pixels
Size: 9.541991 by 5.135196 inches (100 dpi)
Warning messages:
1: The shape merged_for_maps is invalid. See sf::st_is_valid 
2: The shape merged_for_maps is invalid. See sf::st_is_valid 
> 
> proc.time()
   user  system elapsed 
1381.06  349.00 1734.12 


Execute:  R CMD BATCH --no-save "./plot_mw_rents_maps.R" plot_mw_rents_maps.Rout

R version 4.0.3 (2020-10-10) -- "Bunny-Wunnies Freak Out"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> remove(list = ls())
> 
> library(sf)
Linking to GEOS 3.9.0, GDAL 3.2.1, PROJ 7.2.1
Warning message:
package 'sf' was built under R version 4.0.5 
> library(data.table)
> library(dplyr)

Attaching package: 'dplyr'

The following objects are masked from 'package:data.table':

    between, first, last

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

> library(spData)
> library(tmap)
Warning message:
package 'tmap' was built under R version 4.0.5 
> library(tmaptools)
Warning message:
package 'tmaptools' was built under R version 4.0.5 
> library(leaflet)
Warning message:
package 'leaflet' was built under R version 4.0.5 
> library(ggplot2)
> 
> USPS_zipcodes <- read_sf(dsn = "../../../drive/raw_data/shapefiles/USPS_zipcodes", 
+                          layer = "USPS_zipcodes_July2020")
> USPS_zipcodes <- USPS_zipcodes %>%
+   select(ZIP_CODE, PO_NAME, STATE, POPULATION, SQMI, POP_SQMI) %>%
+   rename(zipcode = ZIP_CODE, zipcode_name = PO_NAME,
+          state_name = STATE, pop2020 = POPULATION, 
+          area_sq_miles = SQMI, pop2020_per_sq_miles = POP_SQMI)
> 
> cbsa10_code_san_diego <- 41740
> cbsa10_code_seattle <- 42660
> mw_rent_data <- fread("../../../drive/derived_large/estimation_samples/all_zipcode_months.csv",
+                       colClasses = c(zipcode ="character", place_code ="character", 
+                                      countyfips = "character", cbsa10 = "character",
+                                      zcta ="character", place_name = "character", 
+                                      county_name = "character", cbsa10_name = "character",
+                                      state_abb = "character", statefips = "character")) %>%
+   filter((year == 2018 & month == 10) | (year == 2019 & month == 3)) %>%
+   filter(cbsa10 == cbsa10_code_san_diego | cbsa10 == cbsa10_code_seattle) %>%
+   select(zipcode, cbsa10, year, month, actual_mw, exp_ln_mw, medrentpricepsqft_SFCC) %>%
+   mutate(ln_actual_mw = log(actual_mw),
+          ln_rent_var = log(medrentpricepsqft_SFCC)) %>%
+   group_by(zipcode, cbsa10) %>%
+   summarise(change_actual_mw = last(actual_mw) - first(actual_mw), 
+             change_ln_actual_mw = last(ln_actual_mw) - first(ln_actual_mw),
+             change_exp_ln_mw = last(exp_ln_mw) - first(exp_ln_mw),
+             change_ln_rents = last(ln_rent_var) - first(ln_rent_var))
`summarise()` regrouping output by 'zipcode' (override with `.groups` argument)
> 
> merged <- left_join(USPS_zipcodes, mw_rent_data, by = "zipcode")
> san_diego <- merged %>%
+   filter(cbsa10 == cbsa10_code_san_diego)
> seattle <- merged %>%
+   filter(cbsa10 == cbsa10_code_seattle)
> 
> san_diego_ln_mw_change <- tm_shape(san_diego) + 
+   tm_fill(col = "change_ln_actual_mw",
+           title = "Change in log(MW)",
+           style = "cont",
+           palette = "BuGn") +
+   tm_borders(lwd = .01, alpha = 0.5) +
+   tm_layout(legend.position = c("left", "bottom"))
> tmap_save(san_diego_ln_mw_change, 
+           "../output/san_diego_ln_mw_change.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\san_diego_ln_mw_change.png
Resolution: 817.1347 by 599.6563 pixels
Size: 8.171347 by 5.996563 inches (100 dpi)
> 
> san_diego_exp_ln_mw_change <- tm_shape(san_diego) + 
+   tm_fill(col = "change_exp_ln_mw",
+           title = "Change in experienced log(MW)",
+           style = "cont",
+           palette = "BuGn") +
+   tm_borders(lwd = .01, alpha = 0.5) +
+   tm_layout(legend.position = c("left", "bottom"))
> tmap_save(san_diego_exp_ln_mw_change, 
+           "../output/san_diego_exp_ln_mw_change.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\san_diego_exp_ln_mw_change.png
Resolution: 817.1347 by 599.6563 pixels
Size: 8.171347 by 5.996563 inches (100 dpi)
> 
> san_diego_ln_rents_change <- tm_shape(san_diego) + 
+   tm_fill(col = "change_ln_rents",
+           title = "Change in log(rents per square foot)",
+           style = "cont",
+           palette = "BuGn") +
+   tm_borders(lwd = .01, alpha = 0.5) +
+   tm_layout(legend.position = c("left", "bottom"))
> tmap_save(san_diego_ln_rents_change, 
+           "../output/san_diego_ln_rents_change.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\san_diego_ln_rents_change.png
Resolution: 817.1347 by 599.6563 pixels
Size: 8.171347 by 5.996563 inches (100 dpi)
> 
> seattle_ln_mw_change <- tm_shape(seattle) + 
+   tm_fill(col = "change_ln_actual_mw",
+           title = "Change in log(MW)",
+           style = "cont",
+           palette = "BuGn") +
+   tm_borders(lwd = .01, alpha = 0.5) +
+   tm_layout(legend.position = c("left", "bottom"))
> seattle_ln_mw_change
> tmap_save(seattle_ln_mw_change, 
+           "../output/seattle_ln_mw_change.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\seattle_ln_mw_change.png
Resolution: 621.7924 by 788.0443 pixels
Size: 6.217924 by 7.880443 inches (100 dpi)
> 
> seattle_exp_ln_mw_change <- tm_shape(seattle) + 
+   tm_fill(col = "change_exp_ln_mw",
+           title = "Change in experienced log(MW)",
+           style = "cont",
+           palette = "BuGn") +
+   tm_borders(lwd = .01, alpha = 0.5) +
+   tm_layout(legend.position = c("left", "bottom"))
> tmap_save(seattle_exp_ln_mw_change, 
+           "../output/seattle_exp_ln_mw_change.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\seattle_exp_ln_mw_change.png
Resolution: 621.7924 by 788.0443 pixels
Size: 6.217924 by 7.880443 inches (100 dpi)
> 
> seattle_ln_rents_change <- tm_shape(seattle) + 
+   tm_fill(col = "change_ln_rents",
+           title = "Change in log(rents per square foot)",
+           style = "cont",
+           palette = "BuGn") +
+   tm_borders(lwd = .01, alpha = 0.5) +
+   tm_layout(legend.position = c("left", "bottom"))
> seattle_ln_rents_change
> tmap_save(seattle_ln_rents_change, 
+           "../output/seattle_ln_rents_change.png",
+           dpi = 100)
Map saved to C:\Users\diegog\Desktop\Diego\min_wage_rent\analysis\maps\output\seattle_ln_rents_change.png
Resolution: 621.7924 by 788.0443 pixels
Size: 6.217924 by 7.880443 inches (100 dpi)
> 
> proc.time()
   user  system elapsed 
  55.87   16.56   37.06 

 make.py ended: 2021-09-15 15:29:28
