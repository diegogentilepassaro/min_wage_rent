
 make.py started: 2020-03-11 14:39:18 /Users/dgentil1/Desktop/Diego/min_wage_rent/analysis/code 




Execute:  stataSE -e do "./first_last_event_study.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

120-user Stata network perpetual license:
       Serial number:  401606201670
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./first_last_event_study.do 

. clear all

. set more off

. adopath + ../../lib/stata/mental_coupons/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/dgentil1/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/dgentil1/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../lib/stata/mental_coupons/ado"

. adopath + ../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/dgentil1/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/dgentil1/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../lib/stata/mental_coupons/ado"
  [8]              "../../lib/stata/gslab_misc/ado"

. set maxvar 32000 


. 
. program main
  1.         local instub  "../../derived/output/"
  2.         local outstub "../output/"
  3. 
.         use `instub'data_ready.dta, clear
  4. 
.         prepare_data, time_var(year_month) geo_unit(zipcode)
  5. 
.         foreach var in min_event {
  6.                 foreach window in 12 24 {
  7.                         create_latest_event_vars, event_dummy(`var') window(`window')                         ///
>                             time_var(year_month) geo_unit(zipcode)
  8. 
.                         create_event_plot, depvar(rent2br_median) event_var(last_`var'_rel_months`window')      ///
>                             controls(" ") window(`window') ///
>                                 absorb(zipcode calendar_month year_month)
  9. 
.                         create_event_plot, depvar(rent2br_psqft_median) event_var(last_`var'_rel_months`window')      ///
>                             controls(" ") window(`window') ///
>                                 absorb(zipcode calendar_month year_month)
 10. 
.                         create_event_plot, depvar(zhvi2br) event_var(last_`var'_rel_months`window')      ///
>                             controls(" ") window(`window') ///
>                                 absorb(zipcode msa calendar_month year_month)
 11.                 }
 12.         }
 13. end

. 
. program prepare_data
  1.     syntax, time_var(str) geo_unit(str)
  2. 
.     gen date = dofm(year_month)
  3.         gen calendar_month = month(date)
  4.         drop date
  5.         
.         replace min_event = 0 if dmin_actual_mw < 0.25
  6.         replace mean_event = 0 if dmean_actual_mw < 0.25
  7.         replace max_event = 0 if dmax_actual_mw < 0.25
  8. 
.         drop if missing(msa)
  9.         
.         keep zipcode year_month state msa calendar_month ///
>             zhvi2br rent2br_median rent2br_psqft_median ///
>                 min_event mean_event max_event
 10. end

. 
. program create_latest_event_vars
  1.         syntax, event_dummy(str) window(int) time_var(str) geo_unit(str) [min_option(str)]
  2.         
.         local window_span = `window'*2 + 1 
  3.         
.         gen `event_dummy'_`time_var' = `time_var' if `event_dummy' == 1
  4.         format `event_dummy'_`time_var' %tm
  5.         
.         /*bysort `geo_unit': egen first_`event_dummy'_`time_var' = min(`event_dummy'_`time_var') `min_option'
>         gen first_`event_dummy'_rel_months`window' = `time_var' - first_`event_dummy'_`time_var'
>         replace first_`event_dummy'_rel_months`window' = first_`event_dummy'_rel_months`window' + `window' + 1
>         replace first_`event_dummy'_rel_months`window' = 0 ///
>             if first_`event_dummy'_rel_months`window' <= 0
>         replace first_`event_dummy'_rel_months`window' = 1000 ////
>             if first_`event_dummy'_rel_months`window' > `window_span'*/
.         
.         bysort `geo_unit': egen last_`event_dummy'_`time_var' = max(`event_dummy'_`time_var')
  6.         gen last_`event_dummy'_rel_months`window' = `time_var' - last_`event_dummy'_`time_var'
  7.         replace last_`event_dummy'_rel_months`window' = last_`event_dummy'_rel_months`window' + `window' + 1
  8.         replace last_`event_dummy'_rel_months`window' = 0 ///
>             if last_`event_dummy'_rel_months`window' <= 0
  9.         replace last_`event_dummy'_rel_months`window' = 1000 ///
>             if last_`event_dummy'_rel_months`window' > `window_span'
 10.                 
.         *drop first_`event_dummy'_`time_var'
.         drop `event_dummy'_`time_var' last_`event_dummy'_`time_var'
 11. end

. 
. program create_event_plot
  1.         syntax, depvar(str) event_var(str) controls(str) absorb(str) window(int)
  2. 
.         local window_plus1 = `window' + 1
  3.         local window_span = 2*`window' + 1
  4. 
.         forval i = 1(1)`window_span' {
  5.                 local keep_coeffs = "`keep_coeffs'" + " `i'.`event_var'"
  6.         }
  7. 
.         reghdfe `depvar' ib`window'.`event_var' `controls', nocons ///
>             absorb(`absorb') vce(cluster zipcode)
  8.         
.         coefplot, keep(`keep_coeffs') ///
>                 base vertical graphregion(color(white)) bgcolor(white) ///
>                 xlabel(1 "-`window'" `window_plus1' "0" `window_span' "`window'") ///
>                 xline(`window_plus1', lcol(grey) lpat(dot))
  9.         graph export ../output/`depvar'_`event_var'.png, replace        
 10. end

. 
. main
(41,517 real changes made)
(88,930 real changes made)
(41,517 real changes made)
(1,612,815 observations deleted)
(5,856,357 missing values generated)
(833 missing values generated)
(833 missing values generated)
(5,983,835 real changes made)
(3,689,711 real changes made)
(1,748,887 real changes made)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =    106,315
Absorbing 3 HDFE groups                           F(  26,   2561) =       2.93
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9836
                                                  Adj R-squared   =     0.9832
                                                  Within R-sq.    =     0.0130
Number of clusters (zipcode) =      2,562         Root MSE        =   113.6864

                                           (Std. Err. adjusted for 2,562 clusters in zipcode)
---------------------------------------------------------------------------------------------
                            |               Robust
             rent2br_median |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
----------------------------+----------------------------------------------------------------
last_min_event_rel_months12 |
                         0  |  -65.73333   13.82519    -4.75   0.000    -92.84301   -38.62365
                         1  |   1.081702   11.20932     0.10   0.923    -20.89855    23.06196
                         2  |   11.73405   11.30916     1.04   0.300    -10.44198    33.91007
                         3  |   31.06821   11.65455     2.67   0.008     8.214909     53.9215
                         4  |   31.61459   11.46607     2.76   0.006     9.130874    54.09831
                         5  |   21.75407   10.47925     2.08   0.038       1.2054    42.30275
                         6  |   9.057995    9.57374     0.95   0.344    -9.715064    27.83105
                         7  |   16.86346   9.012718     1.87   0.061    -.8094928    34.53642
                         8  |   21.19668    8.37734     2.53   0.011     4.769636    37.62373
                         9  |     21.182   7.064579     3.00   0.003     7.329129    35.03486
                        10  |   16.56967   6.962829     2.38   0.017     2.916319    30.22301
                        11  |   5.910493   5.257825     1.12   0.261    -4.399527    16.22051
                        13  |  -2.847975    5.86344    -0.49   0.627    -14.34554     8.64959
                        14  |   5.119302   6.237833     0.82   0.412    -7.112406    17.35101
                        15  |   2.377281    7.05407     0.34   0.736    -11.45498    16.20954
                        16  |   15.76126   7.523311     2.09   0.036     1.008869    30.51365
                        17  |   6.036187    7.85795     0.77   0.442    -9.372393    21.44477
                        18  |  -2.016686   7.845674    -0.26   0.797    -17.40119    13.36782
                        19  |  -7.269117    9.01537    -0.81   0.420    -24.94727    10.40904
                        20  |   3.635234   8.922971     0.41   0.684    -13.86174     21.1322
                        21  |   4.981714   9.002799     0.55   0.580    -12.67179    22.63522
                        22  |   7.892078   9.250208     0.85   0.394    -10.24657    26.03072
                        23  |    5.60123   9.426346     0.59   0.552     -12.8828    24.08526
                        24  |   4.556706   9.622963     0.47   0.636    -14.31287    23.42628
                        25  |   7.924997   9.707874     0.82   0.414    -11.11108    26.96108
                      1000  |   19.93306   10.25151     1.94   0.052    -.1690286    40.03515
---------------------------------------------------------------------------------------------

Absorbed degrees of freedom:
--------------------------------------------------------+
    Absorbed FE | Categories  - Redundant  = Num. Coefs |
----------------+---------------------------------------|
        zipcode |      2562        2562           0    *|
 calendar_month |        12           0          12     |
     year_month |       112          12         100     |
--------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(note:  named style grey not found in class color, default attributes used)
(file /Users/dgentil1/Desktop/Diego/min_wage_rent/analysis/code/../output/rent2br_median_last_min_event_rel_months12.png wr
> itten in PNG format)
(dropped 2 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     92,448
Absorbing 3 HDFE groups                           F(  26,   2380) =       5.60
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9857
                                                  Adj R-squared   =     0.9853
                                                  Within R-sq.    =     0.0251
Number of clusters (zipcode) =      2,381         Root MSE        =     0.0973

                                           (Std. Err. adjusted for 2,381 clusters in zipcode)
---------------------------------------------------------------------------------------------
                            |               Robust
       rent2br_psqft_median |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
----------------------------+----------------------------------------------------------------
last_min_event_rel_months12 |
                         0  |   -.061239   .0166787    -3.67   0.000    -.0939453   -.0285328
                         1  |   .0080948   .0108125     0.75   0.454     -.013108    .0292977
                         2  |   .0106463   .0104137     1.02   0.307    -.0097746    .0310671
                         3  |   .0190626     .01079     1.77   0.077    -.0020962    .0402213
                         4  |   .0053916   .0113156     0.48   0.634    -.0167979     .027581
                         5  |   .0040973   .0103553     0.40   0.692     -.016209    .0244036
                         6  |  -.0056711   .0095577    -0.59   0.553    -.0244133    .0130711
                         7  |   .0095756   .0088183     1.09   0.278    -.0077168    .0268679
                         8  |   .0153001   .0082083     1.86   0.062    -.0007961    .0313962
                         9  |   .0083499   .0073313     1.14   0.255    -.0060265    .0227262
                        10  |   .0028431   .0072149     0.39   0.694     -.011305    .0169913
                        11  |   .0010214   .0058009     0.18   0.860    -.0103538    .0123967
                        13  |    .005311   .0069023     0.77   0.442    -.0082241    .0188461
                        14  |   .0150292   .0079951     1.88   0.060     -.000649    .0307073
                        15  |   .0118656   .0081994     1.45   0.148    -.0042132    .0279443
                        16  |   .0153505   .0095165     1.61   0.107    -.0033111     .034012
                        17  |   .0078163   .0101577     0.77   0.442    -.0121025    .0277351
                        18  |    .003881   .0103454     0.38   0.708     -.016406    .0241679
                        19  |  -.0004672   .0110127    -0.04   0.966    -.0220627    .0211282
                        20  |   .0284126   .0107498     2.64   0.008     .0073326    .0494925
                        21  |   .0203719   .0108346     1.88   0.060    -.0008743    .0416181
                        22  |   .0274745   .0105463     2.61   0.009     .0067935    .0481555
                        23  |   .0267344   .0104071     2.57   0.010     .0063264    .0471423
                        24  |   .0277962   .0109543     2.54   0.011     .0063153    .0492772
                        25  |   .0256236   .0108809     2.35   0.019     .0042866    .0469606
                      1000  |   .0644461   .0112118     5.75   0.000     .0424602     .086432
---------------------------------------------------------------------------------------------

Absorbed degrees of freedom:
--------------------------------------------------------+
    Absorbed FE | Categories  - Redundant  = Num. Coefs |
----------------+---------------------------------------|
        zipcode |      2381        2381           0    *|
 calendar_month |        12           0          12     |
     year_month |       117          12         105     |
--------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(note:  named style grey not found in class color, default attributes used)
(file /Users/dgentil1/Desktop/Diego/min_wage_rent/analysis/code/../output/rent2br_psqft_median_last_min_event_rel_months12.
> png written in PNG format)
(MWFE estimator converged in 6 iterations)

HDFE Linear regression                            Number of obs   =  4,629,892
Absorbing 4 HDFE groups                           F(  26,  20990) =      94.43
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.8925
                                                  Adj R-squared   =     0.8919
                                                  Within R-sq.    =     0.0009
Number of clusters (zipcode) =     20,991         Root MSE        = 46081.5744

                                          (Std. Err. adjusted for 20,991 clusters in zipcode)
---------------------------------------------------------------------------------------------
                            |               Robust
                    zhvi2br |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
----------------------------+----------------------------------------------------------------
last_min_event_rel_months12 |
                         0  |   -2707.19   365.0707    -7.42   0.000    -3422.756   -1991.623
                         1  |   -5102.15   143.6513   -35.52   0.000    -5383.717   -4820.582
                         2  |  -4804.287   134.8735   -35.62   0.000     -5068.65   -4539.925
                         3  |  -4316.821   123.6347   -34.92   0.000    -4559.154   -4074.487
                         4  |   -3800.35     111.17   -34.19   0.000    -4018.252   -3582.449
                         5  |  -3296.467   98.72292   -33.39   0.000    -3489.971   -3102.962
                         6  |  -2758.531   84.90713   -32.49   0.000    -2924.955   -2592.106
                         7  |  -2363.847   74.66308   -31.66   0.000    -2510.192   -2217.501
                         8  |  -1938.603    65.3557   -29.66   0.000    -2066.706   -1810.501
                         9  |  -1429.082   54.12377   -26.40   0.000    -1535.168   -1322.995
                        10  |  -868.2472   37.91477   -22.90   0.000     -942.563   -793.9313
                        11  |  -376.1717    19.3596   -19.43   0.000     -414.118   -338.2254
                        13  |   257.6746   20.93763    12.31   0.000     216.6352    298.7139
                        14  |   539.7374   37.34816    14.45   0.000     466.5321    612.9427
                        15  |   670.3108   49.84389    13.45   0.000      572.613    768.0087
                        16  |   1049.624   55.91289    18.77   0.000     940.0304    1159.217
                        17  |   1356.655   61.73436    21.98   0.000     1235.651    1477.659
                        18  |   1644.229   68.27888    24.08   0.000     1510.397    1778.061
                        19  |   1750.786   75.68703    23.13   0.000     1602.433    1899.138
                        20  |   1858.614   82.68436    22.48   0.000     1696.546    2020.681
                        21  |   1969.769   90.05129    21.87   0.000     1793.261    2146.276
                        22  |   2206.572   96.94182    22.76   0.000     2016.558    2396.585
                        23  |   2519.888   103.6528    24.31   0.000     2316.721    2723.056
                        24  |   2871.208   110.2552    26.04   0.000       2655.1    3087.317
                        25  |   3054.194   119.1377    25.64   0.000     2820.675    3287.713
                      1000  |  -5460.341   544.2133   -10.03   0.000    -6527.041   -4393.641
---------------------------------------------------------------------------------------------

Absorbed degrees of freedom:
--------------------------------------------------------+
    Absorbed FE | Categories  - Redundant  = Num. Coefs |
----------------+---------------------------------------|
        zipcode |     20991       20991           0    *|
            msa |       859           0         859     |
 calendar_month |        12           1          11     |
     year_month |       285          12         273    ?|
--------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(note:  named style grey not found in class color, default attributes used)
(file /Users/dgentil1/Desktop/Diego/min_wage_rent/analysis/code/../output/zhvi2br_last_min_event_rel_months12.png written i
> n PNG format)
(5,856,357 missing values generated)
(833 missing values generated)
(833 missing values generated)
(5,983,835 real changes made)
(3,437,691 real changes made)
(1,496,851 real changes made)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =    106,315
Absorbing 3 HDFE groups                           F(  50,   2561) =       2.44
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9838
                                                  Adj R-squared   =     0.9834
                                                  Within R-sq.    =     0.0223
Number of clusters (zipcode) =      2,562         Root MSE        =   113.1653

                                           (Std. Err. adjusted for 2,562 clusters in zipcode)
---------------------------------------------------------------------------------------------
                            |               Robust
             rent2br_median |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
----------------------------+----------------------------------------------------------------
last_min_event_rel_months24 |
                         0  |  -105.1963   17.08688    -6.16   0.000    -138.7018   -71.69076
                         1  |  -36.91378   13.94948    -2.65   0.008    -64.26719   -9.560376
                         2  |  -27.38627   14.23271    -1.92   0.054    -55.29506    .5225238
                         3  |  -15.82423   14.01762    -1.13   0.259    -43.31125    11.66278
                         4  |  -17.11453   13.60314    -1.26   0.208    -43.78879    9.559741
                         5  |  -20.78731   12.96373    -1.60   0.109    -46.20776    4.633149
                         6  |  -3.264476   12.78189    -0.26   0.798    -28.32836    21.79941
                         7  |   12.89966   11.88827     1.09   0.278    -10.41193    36.21125
                         8  |   12.83789   11.41443     1.12   0.261    -9.544571    35.22035
                         9  |   .0079683   12.02354     0.00   0.999    -23.56889    23.58482
                        10  |   7.716281   10.75969     0.72   0.473     -13.3823    28.81486
                        11  |   5.315478   10.77045     0.49   0.622    -15.80421    26.43516
                        12  |   10.36019   12.34669     0.84   0.401    -13.85031     34.5707
                        13  |   11.72722   11.07524     1.06   0.290    -9.990118    33.44456
                        14  |   20.94451   11.30423     1.85   0.064    -1.221847    43.11086
                        15  |   38.13299   11.83799     3.22   0.001     14.91998    61.34599
                        16  |   38.43205   11.57985     3.32   0.001     15.72522    61.13888
                        17  |   28.17347   10.50279     2.68   0.007     7.578644     48.7683
                        18  |   15.17657    9.57451     1.59   0.113    -3.597995    33.95114
                        19  |   16.84114   8.990458     1.87   0.061    -.7881667    34.47045
                        20  |   21.09631   8.375531     2.52   0.012     4.672806    37.51981
                        21  |   21.06484   7.058319     2.98   0.003     7.224245    34.90543
                        22  |   16.29174   6.951037     2.34   0.019     2.661514    29.92196
                        23  |   5.774496   5.255299     1.10   0.272     -4.53057    16.07956
                        25  |  -2.283579   5.841434    -0.39   0.696    -13.73799    9.170836
                        26  |   5.831746   6.214789     0.94   0.348    -6.354776    18.01827
                        27  |   3.209948   7.044121     0.46   0.649     -10.6028     17.0227
                        28  |   16.55116   7.528409     2.20   0.028     1.788771    31.31355
                        29  |   6.859598   7.895372     0.87   0.385    -8.622364    22.34156
                        30  |  -.6559792   7.884543    -0.08   0.934    -16.11671    14.80475
                        31  |  -4.956082   9.046958    -0.55   0.584    -22.69618    12.78401
                        32  |   5.000574   8.880807     0.56   0.573    -12.41372    22.41487
                        33  |   5.956086   8.955347     0.67   0.506    -11.60437    23.51654
                        34  |   9.073955   9.177829     0.99   0.323    -8.922765    27.07067
                        35  |    7.16547   9.316604     0.77   0.442    -11.10337    25.43431
                        36  |   6.582612    9.51378     0.69   0.489    -12.07287    25.23809
                        37  |   10.79165   9.621024     1.12   0.262     -8.07413    29.65742
                        38  |   13.43361   9.669045     1.39   0.165    -5.526329    32.39355
                        39  |   11.12232   9.836048     1.13   0.258    -8.165091    30.40974
                        40  |   10.37208   9.648155     1.08   0.282    -8.546899    29.29106
                        41  |   12.85196   9.817036     1.31   0.191    -6.398174     32.1021
                        42  |   12.24775   10.03417     1.22   0.222    -7.428155    31.92366
                        43  |   13.84358   10.15207     1.36   0.173    -6.063526    33.75068
                        44  |   17.21834    10.2409     1.68   0.093    -2.862944    37.29963
                        45  |   16.42125   10.22577     1.61   0.108    -3.630367    36.47287
                        46  |    13.8315   10.24911     1.35   0.177    -6.265881    33.92888
                        47  |   12.43168   10.39378     1.20   0.232    -7.949377    32.81274
                        48  |   25.96221   11.72748     2.21   0.027     2.965903    48.95852
                        49  |   32.43603   11.16808     2.90   0.004     10.53665    54.33542
                      1000  |   38.98896   10.83968     3.60   0.000     17.73353     60.2444
---------------------------------------------------------------------------------------------

Absorbed degrees of freedom:
--------------------------------------------------------+
    Absorbed FE | Categories  - Redundant  = Num. Coefs |
----------------+---------------------------------------|
        zipcode |      2562        2562           0    *|
 calendar_month |        12           0          12     |
     year_month |       112          12         100     |
--------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(note:  named style grey not found in class color, default attributes used)
(file /Users/dgentil1/Desktop/Diego/min_wage_rent/analysis/code/../output/rent2br_median_last_min_event_rel_months24.png wr
> itten in PNG format)
(dropped 2 singleton observations)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     92,448
Absorbing 3 HDFE groups                           F(  50,   2380) =       3.99
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.9859
                                                  Adj R-squared   =     0.9855
                                                  Within R-sq.    =     0.0364
Number of clusters (zipcode) =      2,381         Root MSE        =     0.0968

                                           (Std. Err. adjusted for 2,381 clusters in zipcode)
---------------------------------------------------------------------------------------------
                            |               Robust
       rent2br_psqft_median |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
----------------------------+----------------------------------------------------------------
last_min_event_rel_months24 |
                         0  |    -.10595   .0212898    -4.98   0.000    -.1476985   -.0642015
                         1  |  -.0278144   .0162183    -1.72   0.086    -.0596178     .003989
                         2  |  -.0252023   .0167341    -1.51   0.132    -.0580172    .0076127
                         3  |  -.0200115   .0172819    -1.16   0.247    -.0539006    .0138776
                         4  |  -.0219342   .0161286    -1.36   0.174    -.0535617    .0096933
                         5  |   -.017666   .0147205    -1.20   0.230    -.0465322    .0112002
                         6  |  -.0025353   .0148431    -0.17   0.864     -.031642    .0265714
                         7  |   .0030745   .0140805     0.22   0.827    -.0245369    .0306859
                         8  |  -.0006475   .0126489    -0.05   0.959    -.0254516    .0241566
                         9  |  -.0239428   .0132344    -1.81   0.071     -.049895    .0020094
                        10  |  -.0128256   .0129162    -0.99   0.321    -.0381536    .0125025
                        11  |   -.001233   .0132256    -0.09   0.926    -.0271679    .0247019
                        12  |   .0021811    .011862     0.18   0.854    -.0210798     .025442
                        13  |   .0146255   .0107665     1.36   0.174    -.0064872    .0357382
                        14  |   .0146834    .010244     1.43   0.152    -.0054048    .0347715
                        15  |    .021415      .0108     1.98   0.047     .0002366    .0425935
                        16  |   .0082937   .0112213     0.74   0.460    -.0137108    .0302982
                        17  |   .0080568   .0102668     0.78   0.433     -.012076    .0281895
                        18  |  -.0018119   .0093101    -0.19   0.846    -.0200687    .0164449
                        19  |   .0089249   .0087664     1.02   0.309    -.0082658    .0261155
                        20  |   .0140847   .0081942     1.72   0.086    -.0019838    .0301533
                        21  |     .00816   .0073275     1.11   0.266     -.006209     .022529
                        22  |   .0023666   .0072052     0.33   0.743    -.0117625    .0164956
                        23  |   .0007933    .005778     0.14   0.891    -.0105371    .0121237
                        25  |   .0056989   .0069206     0.82   0.410    -.0078721    .0192698
                        26  |   .0151263   .0079565     1.90   0.057     -.000476    .0307286
                        27  |   .0120513   .0081499     1.48   0.139    -.0039303    .0280329
                        28  |   .0155827    .009477     1.64   0.100    -.0030013    .0341666
                        29  |   .0080531   .0102186     0.79   0.431    -.0119852    .0280914
                        30  |   .0038135   .0103683     0.37   0.713    -.0165184    .0241454
                        31  |   .0003789   .0110496     0.03   0.973    -.0212889    .0220468
                        32  |   .0259481   .0107008     2.42   0.015     .0049642     .046932
                        33  |   .0185465   .0107733     1.72   0.085    -.0025796    .0396726
                        34  |   .0262706   .0105579     2.49   0.013      .005567    .0469742
                        35  |   .0263275   .0103954     2.53   0.011     .0059424    .0467126
                        36  |   .0283664   .0109314     2.59   0.010     .0069304    .0498024
                        37  |   .0270182   .0108594     2.49   0.013     .0057234    .0483131
                        38  |   .0311222   .0105739     2.94   0.003     .0103872    .0518572
                        39  |    .037425   .0106535     3.51   0.000     .0165338    .0583161
                        40  |   .0404437    .011109     3.64   0.000     .0186595     .062228
                        41  |   .0484331   .0113035     4.28   0.000     .0262674    .0705987
                        42  |   .0531863    .011338     4.69   0.000     .0309529    .0754197
                        43  |   .0517423   .0112487     4.60   0.000      .029684    .0738006
                        44  |   .0525737   .0111885     4.70   0.000     .0306335    .0745138
                        45  |   .0556167   .0113263     4.91   0.000     .0334063     .077827
                        46  |   .0556991   .0114568     4.86   0.000     .0332327    .0781655
                        47  |   .0582602   .0114564     5.09   0.000     .0357947    .0807256
                        48  |   .0626125   .0116176     5.39   0.000     .0398309    .0853941
                        49  |   .0695509   .0117625     5.91   0.000     .0464851    .0926168
                      1000  |   .0858131   .0118182     7.26   0.000     .0626381    .1089881
---------------------------------------------------------------------------------------------

Absorbed degrees of freedom:
--------------------------------------------------------+
    Absorbed FE | Categories  - Redundant  = Num. Coefs |
----------------+---------------------------------------|
        zipcode |      2381        2381           0    *|
 calendar_month |        12           0          12     |
     year_month |       117          12         105     |
--------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(note:  named style grey not found in class color, default attributes used)
(file /Users/dgentil1/Desktop/Diego/min_wage_rent/analysis/code/../output/rent2br_psqft_median_last_min_event_rel_months24.
> png written in PNG format)
(MWFE estimator converged in 6 iterations)

HDFE Linear regression                            Number of obs   =  4,629,892
Absorbing 4 HDFE groups                           F(  50,  20990) =      68.30
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.8929
                                                  Adj R-squared   =     0.8924
                                                  Within R-sq.    =     0.0047
Number of clusters (zipcode) =     20,991         Root MSE        = 45993.5537

                                          (Std. Err. adjusted for 20,991 clusters in zipcode)
---------------------------------------------------------------------------------------------
                            |               Robust
                    zhvi2br |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
----------------------------+----------------------------------------------------------------
last_min_event_rel_months24 |
                         0  |   1009.676   406.3545     2.48   0.013     213.1898    1806.162
                         1  |  -7579.756   243.1739   -31.17   0.000    -8056.396   -7103.117
                         2  |  -8324.434   246.1848   -33.81   0.000    -8806.975   -7841.893
                         3  |   -8033.84   238.2886   -33.71   0.000    -8500.904   -7566.776
                         4  |  -7670.689   229.6219   -33.41   0.000    -8120.766   -7220.612
                         5  |  -7282.269   219.8462   -33.12   0.000    -7713.185   -6851.354
                         6  |  -7105.889   207.8236   -34.19   0.000     -7513.24   -6698.539
                         7  |  -6987.741   199.0598   -35.10   0.000    -7377.913   -6597.568
                         8  |  -6722.632   188.8078   -35.61   0.000     -7092.71   -6352.554
                         9  |  -6300.431   179.0725   -35.18   0.000    -6651.427   -5949.435
                        10  |  -5862.824   168.3372   -34.83   0.000    -6192.778    -5532.87
                        11  |  -5309.998   157.0034   -33.82   0.000    -5617.737    -5002.26
                        12  |  -4930.668   144.2765   -34.18   0.000    -5213.461   -4647.874
                        13  |   -4445.94   132.6676   -33.51   0.000    -4705.979   -4185.901
                        14  |  -4152.198   123.4615   -33.63   0.000    -4394.192   -3910.204
                        15  |  -3637.729   113.8878   -31.94   0.000    -3860.958     -3414.5
                        16  |  -3051.164   103.2115   -29.56   0.000    -3253.466   -2848.861
                        17  |  -2471.484   93.24447   -26.51   0.000    -2654.251   -2288.718
                        18  |  -1842.136   83.18579   -22.14   0.000    -2005.186   -1679.085
                        19  |      -1437    75.4006   -19.06   0.000    -1584.791   -1289.209
                        20  |  -1034.679   67.21081   -15.39   0.000    -1166.418   -902.9408
                        21  |  -1560.368   53.61983   -29.10   0.000    -1665.467   -1455.269
                        22  |   -952.436   37.08792   -25.68   0.000    -1025.131   -879.7409
                        23  |  -449.0887   18.05472   -24.87   0.000    -484.4774   -413.7001
                        25  |  -211.8194   27.16226    -7.80   0.000    -265.0595   -158.5793
                        26  |  -330.6806   49.69725    -6.65   0.000     -428.091   -233.2701
                        27  |  -17.06588   57.86079    -0.29   0.768    -130.4775    96.34573
                        28  |   366.5231   61.97103     5.91   0.000     245.0551    487.9911
                        29  |   721.2092   66.37731    10.87   0.000     591.1045    851.3138
                        30  |   516.1732   78.21627     6.60   0.000     362.8633    669.4831
                        31  |   551.1523   86.02737     6.41   0.000      382.532    719.7725
                        32  |   567.4802   93.69167     6.06   0.000     383.8374    751.1231
                        33  |    799.499   99.64543     8.02   0.000     604.1863    994.8117
                        34  |   1103.683   105.9765    10.41   0.000     895.9608    1311.405
                        35  |   1485.846   112.0737    13.26   0.000     1266.173    1705.519
                        36  |    1891.53    118.686    15.94   0.000     1658.896    2124.164
                        37  |   2115.966   127.4424    16.60   0.000     1866.169    2365.763
                        38  |    2364.52   135.6241    17.43   0.000     2098.686    2630.354
                        39  |   2343.925   146.1961    16.03   0.000     2057.369    2630.481
                        40  |   2852.199   152.9759    18.64   0.000     2552.354    3152.043
                        41  |   3463.095   160.0016    21.64   0.000     3149.479     3776.71
                        42  |   4027.567   167.5147    24.04   0.000     3699.226    4355.909
                        43  |   4260.576   174.8597    24.37   0.000     3917.837    4603.314
                        44  |   4376.091   182.5455    23.97   0.000     4018.288    4733.894
                        45  |    4700.75   189.8623    24.76   0.000     4328.605    5072.895
                        46  |   5242.343   196.2279    26.72   0.000     4857.721    5626.965
                        47  |    5723.35   203.0914    28.18   0.000     5325.275    6121.424
                        48  |   6117.034   210.7046    29.03   0.000     5704.036    6530.031
                        49  |   5856.571   222.9052    26.27   0.000      5419.66    6293.483
                      1000  |  -10859.78   724.6866   -14.99   0.000    -12280.22   -9439.339
---------------------------------------------------------------------------------------------

Absorbed degrees of freedom:
--------------------------------------------------------+
    Absorbed FE | Categories  - Redundant  = Num. Coefs |
----------------+---------------------------------------|
        zipcode |     20991       20991           0    *|
            msa |       859           0         859     |
 calendar_month |        12           1          11     |
     year_month |       285          12         273    ?|
--------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation
(note:  named style grey not found in class color, default attributes used)
(file /Users/dgentil1/Desktop/Diego/min_wage_rent/analysis/code/../output/zhvi2br_last_min_event_rel_months24.png written i
> n PNG format)

. 
end of do-file


Execute:  stataSE -e do "./event_study.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

120-user Stata network perpetual license:
       Serial number:  401606201670
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./event_study.do 

. clear all

. set more off

. adopath + ../../lib/stata/mental_coupons/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/dgentil1/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/dgentil1/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../lib/stata/mental_coupons/ado"

. adopath + ../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/dgentil1/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/dgentil1/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../lib/stata/mental_coupons/ado"
  [8]              "../../lib/stata/gslab_misc/ado"

. set maxvar 32000 


. 
. program main
  1.         local instub  "../../derived/output/"
  2.         local outstub "../output/"
  3. 
.         use `instub'zipcode_yearmonth_panel.dta, clear
  4. 
.         prepare_data, time_var(year_month) geo_unit(zipcode)
  5. 
.         foreach var in min_event mean_event{
  6.                 foreach window in 6 12{
  7.                         create_event_vars, event_dummy(`var') window(`window')                         ///
>                             time_var(year_month) geo_unit(zipcode)
  8.                                 
.                         create_event_plot, depvar(rent2br_median) event_var(rel_months_`var'`window')      ///
>                             controls(" ") absorb(zipcode calendar_month##state year_month year_month##state) window(`wind
> ow')
  9. 
.                         create_event_plot, depvar(rent2br_psqft_median) event_var(rel_months_`var'`window')      ///
>                             controls(" ") absorb(zipcode calendar_month##state year_month year_month##state) window(`wind
> ow')
 10. 
.                         create_event_plot, depvar(zhvi2br) event_var(rel_months_`var'`window')             ///
>                             controls(" ") absorb(zipcode calendar_month##state year_month year_month##state) window(`wind
> ow')
 11.                 }
 12.         }
 13.         
. end

. 
. program prepare_data
  1.     syntax, time_var(str) geo_unit(str)
  2. 
.     gen date = dofm(year_month)
  3.         gen calendar_month = month(date)
  4.         drop date
  5. end

. 
. program create_event_vars
  1.         syntax, event_dummy(str) window(int) time_var(str) geo_unit(str)
  2.                 
.         * Diego's approach fixed. Use difference in dates (doesn't exclude overlapping)
. 
.         /* gen `event_dummy'_`time_var' = `time_var' if `event_dummy' == 1
>         format `event_dummy'_`time_var' %tm
>         bysort `geo_unit' (`time_var'): carryforward `event_dummy'_`time_var', replace
> 
>         gen rel_months_`event_dummy' = `time_var' - F`window'.`event_dummy'_`time_var'
>         replace rel_months_`event_dummy' = 1000 if !inrange(rel_months_`event_dummy', -`window', `window')
>         replace rel_months_`event_dummy' = rel_months_`event_dummy' + `window' + 1 if rel_months_`event_dummy' < 1000
>         */
. 
.         * Santi's approach. Idenfity "beginning of event" and add 12
.         bysort `geo_unit' (`time_var'): gen event_start = 1 if `event_dummy'[_n + `window'] == 1
  3.         gen event_start_non_overlap = event_start
  4.         forvalues i = 0(1)`window' {                                            // Set to missing if i days ago there 
> was a mw increase
  5.                 bysort `geo_unit' (`time_var'): replace event_start_non_overlap = . if `event_dummy'[_n - `i'] == 1
  6.         }
  7.         
.         local window_span = 2*`window' + 1
  8.         gen rel_months_`event_dummy' = event_start_non_overlap
  9.         forvalues i = 2(1)`window_span' {                                       // Set to i if i days ago an event sta
> rted 
 10.                 bysort `geo_unit' (`time_var'): replace rel_months_`event_dummy' = `i' if event_start_non_overlap[_n -
>  `i' + 1] == 1
 11.         }
 12.         replace rel_months_`event_dummy' = 1000 if rel_months_`event_dummy' == .
 13. 
. 
.         drop event_start event_start_non_overlap
 14.         rename rel_months_`event_dummy' rel_months_`event_dummy'`window'
 15.         sort `geo_unit' `time_var'
 16.         
. end

. 
. program create_event_plot
  1.         syntax, depvar(str) event_var(str) controls(str) absorb(str) window(int)
  2. 
.         local window_plus1 = `window' + 1
  3.         local window_span = 2*`window' + 1
  4.         
.         reghdfe `depvar' ib`window'.`event_var' `controls', absorb(`absorb') vce(cluster zipcode)
  5.         
.         coefplot, drop(1000.`event_var' _cons `controls')                                                       ///
>                 base vertical graphregion(color(white)) bgcolor(white)                                  ///
>                 xlabel(1 "-`window'" `window_plus1' "0" `window_span' "`window'")               ///
>                 xline(`window_plus1', lcol(grey) lpat(dot))
  6.         graph export ../output/`depvar'_`event_var'.png, replace        
  7. end

. 
. main
file ../../derived/output/zipcode_yearmonth_panel.dta not found
r(601);

end of do-file
r(601);

 make.py ended: 2020-03-11 15:14:35
