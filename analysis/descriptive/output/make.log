
 make.py started: 2020-09-06 13:01:17 /Users/gabriborg/Dropbox (Brown)/research/min_wage_rent/analysis/descriptive/code 




Execute:  stataSE -e do "./desc_stats_general.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

120-user Stata network perpetual license:
       Serial number:  401606201670
         Licensed to:  Brown University
                       Brown University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./desc_stats_general.do 

. set more off

. clear all

. adopath + ../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/gabriborg/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/gabriborg/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../lib/stata/gslab_misc/ado"

. adopath + ../../lib/stata/mental_coupons/ado
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/gabriborg/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/gabriborg/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "../../lib/stata/gslab_misc/ado"
  [8]              "../../lib/stata/mental_coupons/ado"

. 
. 
. program main 
  1.         local instub  = "../../../drive/" 
  2.         local outstub = "../output/"
  3. 
.         // us_stats, instub(`instub')
.         us_stats_new, instub(`instub')
  4. 
.         baseline_rent_stats, instub(`instub') target_zillow("medrentpricepsqft_2br medrentpricepsqft_mfr5plus medrentpricepsqft_sfc
> c")
  5.         baseline_listing_stats, instub(`instub') target_zillow("medlistingpricepsqft_sfcc medlistingpricepsqft_low_tier medlisti
> ngpricepsqft_top_tier")
  6.         baseline_yearmonth_stats, instub(`instub') target_zillow("medrentpricepsqft_2br medrentpricepsqft_mfr5plus medrentpricep
> sqft_sfcc medlistingpricepsqft_sfcc medlistingpricepsqft_low_tier medlistingpricepsqft_top_tier")
  7. 
.         build_table, target_zillow("medrentpricepsqft_2br medrentpricepsqft_mfr5plus medrentpricepsqft_sfcc medlistingpricepsqft_sf
> cc medlistingpricepsqft_low_tier medlistingpricepsqft_top_tier") 
  8. end 

. 
. 
. program us_stats_new 
  1.         syntax, instub(str)
  2. 
.         import delim `instub'/base_large/output/zip_demo.csv, clear
  3. 
.         collapse (sum) pop2010 housing_units2010 (mean) urb_share2010 college_share2010 poor_share20105 black_share2010 hisp_share2
> 010 child_share2010 elder_share2010 unemp_share20105 med_hhinc20105 renthouse_share2010 work_county_share20105 (count) zipcode
  4. 
.         g pop_sh = 1
  5.         g housing_units_sh = 1
  6.         g zipcode_sh = 1
  7. 
.         order zipcode zipcode_sh pop2010 pop_sh housing_units2010 housing_units_sh med_hhinc20105 renthouse_share2010 urb_share2010
>  college_share2010 black_share2010 hisp_share2010 poor_share20105 child_share2010 elder_share2010 unemp_share20105 work_county_shar
> e20105
  8.         save ../temp/us_panel_stats_zipcode.dta, replace
  9. 
.         keep pop2010 housing_units2010 zipcode
 10.         rename (pop housing_units zipcode) (USpop UShousing_units USzipcode)
 11.         save ../temp/us_totals.dta, replace 
 12. end

. 
. 
. program us_stats
  1.         syntax, instub(str)
  2. 
.         import delim `instub'/raw_data/census/tract/nhgis0041_csv/nhgis0041_ds239_20185_2018_tract.csv, clear
  3. 
.         g statefips = string(statea, "%02.0f")
  4.         g countyfips = string(countya, "%03.0f")
  5.         g tractfips = string(tracta, "%06.0f")
  6. 
.         g tract_fips = statefips + countyfips + tractfips
  7. 
.         rename (ajwme001 aj1se001 ajzae001) (pop housing_units med_hhinc)
  8. 
.         g housing_rent_sh = aj1ue003 / aj1ue001
  9. 
.         
.         order aj1ue003 aj1ue001, last
 10.         replace housing_rent_sh = 0 if aj1ue003 == 0 & aj1um001==0 
 11. 
.         keep tract_fips pop housing_units housing_rent_sh med_hhinc
 12. 
.         save ../temp/us_stats_tract.dta, replace
 13. 
.         import excel `instub'/raw_data/hud_Xwalks/TRACT_ZIP_122018.xlsx, firstrow clear
 14.         rename (tract zip) (tract_fips zipcode)
 15.         keep tract_fips zipcode tot_ratio
 16. 
. 
.         merge m:1 tract_fips using ../temp/us_stats_tract.dta, nogen assert(1 2 3) keep(1 3)
 17.         sort zipcode
 18. 
.         collapse (sum) pop housing_units (mean) med_hhinc housing_rent_sh [iw = tot_ratio], by (zipcode)
 19. 
.         save ../temp/us_stats_zipcode.dta, replace
 20. 
.         destring zipcode, replace
 21.         collapse (sum) pop housing_units (mean) med_hhinc housing_rent_sh (count) zipcode
 22. 
.         g pop_sh = 1
 23.         g housing_units_sh = 1
 24.         g zipcode_sh = 1
 25. 
.         order zipcode zipcode_sh pop pop_sh housing_units housing_units_sh med_hhinc housing_rent_sh
 26.         save ../temp/us_panel_stats_zipcode.dta, replace
 27. 
.         keep pop housing_units zipcode
 28.         rename (pop housing_units zipcode) (USpop UShousing_units USzipcode)
 29.         save ../temp/us_totals.dta, replace 
 30. end

. 
. program baseline_rent_stats
  1.         syntax, instub(str) target_zillow(str)
  2.         use `instub'/derived_large/output/baseline_rent_panel.dta, clear
  3. 
.         create_stats_final_dsets, target_zillow(`target_zillow')
  4.         save ../temp/rent_panel_stats_zipcode.dta, replace 
  5. end 

. 
. 
. program baseline_listing_stats
  1.         syntax, instub(str) target_zillow(str)
  2. 
.         use `instub'/derived_large/output/baseline_listing_panel.dta, clear
  3. 
.         create_stats_final_dsets, target_zillow(`target_zillow')
  4. 
.         
.         save ../temp/listing_panel_stats_zipcode.dta, replace 
  5. end 

. 
. 
. program baseline_yearmonth_stats
  1.         syntax, instub(str) target_zillow(str)
  2. 
.         use "../../../drive/derived_large/output/zipcode_yearmonth_panel_all.dta", clear
  3.         replace sal_mw_event =. if missing(mw_event)    
  4. 
.         local target_zillow_count = ""
  5.         foreach var of local target_zillow {
  6.                 local newvar "N`var' = `var'"
  7.                 local target_zillow_count = `"`target_zillow_count' `newvar' "'
  8.         }
  9.                 
.         collapse (sum)  mw_event sal_mw_event fed_event state_event county_event local_event ///
>                          (mean)  `target_zillow' ///
>                          (count) `target_zillow_count' ///
>                          (first) pop2010 housing_units2010 urb_share2010 college_share2010 poor_share20105 black_share2010 hisp_sha
> re2010 child_share2010 elder_share2010 unemp_share20105 med_hhinc20105 renthouse_share2010 work_county_share20105 ///
>                         , by(zipcode)
 10. 
. 
. 
. 
.         local target_zillow_N = ""
 11.         foreach var of local target_zillow {
 12.                 local newvar "N`var'"
 13.                 local target_zillow_N = `"`target_zillow_N' `newvar' "'
 14.         }
 15. 
.         foreach var in `target_zillow_N' {
 16.                 replace `var' = . if `var'==0
 17.         } 
 18. 
.         
.         collapse (sum)  pop2010 housing_units2010 ///
>                          (mean)  urb_share2010 college_share2010 poor_share20105 black_share2010 hisp_share2010 ///
>                                      child_share2010 elder_share2010 unemp_share20105 med_hhinc20105 renthouse_share2010 work_count
> y_share20105 ///
>                                      mw_event sal_mw_event fed_event state_event county_event local_event ///
>                                      `target_zillow'  ///
>                          (count) zipcode `target_zillow_N'
 19. 
.         
. 
.         merge 1:1 _n using ../temp/us_totals, nogen assert(1 2 3)
 20. 
.         g pop_sh = pop2010/USpop
 21.         g housing_units_sh = housing_units2010/UShousing_units
 22.         g zipcode_sh = zipcode/USzipcode
 23. 
.         drop USpop UShousing_units USzipcode
 24. 
.         order zipcode zipcode_sh pop2010 pop_sh housing_units2010 housing_units_sh med_hhinc20105 renthouse_share2010 urb_share2010
>  college_share2010 black_share2010 hisp_share2010 poor_share20105 child_share2010 elder_share2010 unemp_share20105 work_county_shar
> e20105 mw_event sal_mw_event fed_event state_event county_event local_event
 25. 
.         // keep if year_month == `=tm(2019m1)'
.         // g zip2 = string(zipcode, "%05.0f")
.         // drop zipcode 
.         // rename zip2 zipcode 
.         // tempfile baseline_yearmonth_zip 
.         // save "`baseline_yearmonth_zip'", replace 
. 
.         // use ../temp/us_stats_zipcode.dta, clear 
. 
.         // merge 1:1 zipcode using `baseline_yearmonth_zip', nogen assert(1 2 3) keep(1 3)
. 
.         // destring zipcode, replace
. 
.         // collapse (sum) pop housing_units (mean) med_hhinc housing_rent_sh (count) zipcode
. 
.         // merge 1:1 _n using ../temp/us_totals, nogen assert(1 2 3)
. 
.         // g pop_sh = pop/USpop
.         // g housing_units_sh = housing_units/UShousing_units
.         // g zipcode_sh = zipcode/USzipcode
. 
.         // drop USpop UShousing_units USzipcode
. 
.         // order zipcode zipcode_sh pop pop_sh housing_units housing_units_sh med_hhinc housing_rent_sh
. 
.         save ../temp/yearmonth_panel_stats_zipcode.dta, replace 
 26. end 

. 
. 
. program build_table 
  1.         syntax, target_zillow(str)
  2. 
.         local table_len = 23 
  3.         foreach var of local target_zillow {
  4. 
.                 local table_len = `table_len' + 2
  5.         }
  6. 
. 
.         mat t = J(`table_len', 4, .)
  7.         
.         use          ../temp/us_panel_stats_zipcode.dta, clear
  8.         append using ../temp/yearmonth_panel_stats_zipcode.dta
  9.         append using ../temp/listing_panel_stats_zipcode.dta
 10.         append using ../temp/rent_panel_stats_zipcode.dta
 11.         
.         format pop2010 housing_units2010 med_hhinc %20.0fc
 12. 
.         foreach var in pop2010 housing_units2010 {
 13.                 replace `var' = `var'/1000000
 14.         }
 15. 
. 
.         forval x = 1/4 {
 16.                 mat t[1, `x'] = zipcode[`x']
 17.                 mat t[2, `x'] = round(zipcode_sh[`x'], .001) 
 18.                 mat t[3, `x'] = round(pop2010[`x'], .001)
 19.                 mat t[4, `x'] = round(pop_sh[`x'], .001)
 20.                 mat t[5, `x'] = round(housing_units2010[`x'], .001)
 21.                 mat t[6, `x'] = round(housing_units_sh[`x'], .001)
 22.                 mat t[7, `x'] = round(med_hhinc20105[`x']', 1)
 23.                 mat t[8, `x'] = round(renthouse_share2010[`x'], .001)
 24.                 mat t[9, `x'] = round(urb_share2010[`x'], .001)
 25.                 mat t[10, `x'] = round(college_share2010[`x'], .001)
 26.                 mat t[11, `x'] = round(black_share2010[`x'], .001)
 27.                 mat t[12, `x'] = round(hisp_share2010[`x'], .001)
 28.                 mat t[13, `x'] = round(poor_share20105[`x'], .001)
 29.                 mat t[14, `x'] = round(child_share2010[`x'], .001)
 30.                 mat t[15, `x'] = round(elder_share2010[`x'], .001)
 31.                 mat t[16, `x'] = round(unemp_share20105[`x'], .001)
 32.                 mat t[17, `x'] = round(work_county_share20105[`x'], .001)
 33.                 mat t[18, `x'] = round(mw_event[`x'], .001)
 34.                 mat t[19, `x'] = round(sal_mw_event[`x'], .001)
 35.                 mat t[20, `x'] = round(fed_event[`x'], .001)
 36.                 mat t[21, `x'] = round(state_event[`x'], .001)
 37.                 mat t[22, `x'] = round(county_event[`x'], .001)
 38.                 mat t[23, `x'] = round(local_event[`x'], .001)
 39.         }
 40. 
.         local tabrow = 24
 41. 
.         local target_zillow_both = ""
 42.         foreach var of local target_zillow {
 43.                 local target_zillow_both = `"`target_zillow_both' `var' N`var'"'
 44.         }
 45. 
.         di "`target_zillow_both'"
 46.         foreach var in `target_zillow_both' {
 47.                 forval x = 1/4 {
 48.                         mat t[`tabrow', `x'] = round(`var'[`x'], .001)
 49.                 }
 50.                 local tabrow = `tabrow' + 1
 51.         }
 52. 
.         local label_zillow = ""
 53.         foreach var of local target_zillow_both {
 54.                 if "`var'" == "medrentpricepsqft_sfcc" {
 55.                         local label_zillow = `"`label_zillow' "Median Rent psqft SFCC""'
 56.                 }
 57.                 if "`var'" == "Nmedrentpricepsqft_sfcc" | "`var'" == "Nmedrentpricepsqft_2br" | "`var'" == "Nmedrentpricepsqft_m
> fr5plus" | "`var'" == "Nmedlistingpricepsqft_sfcc" | "`var'" == "Nmedlistingpricepsqft_low_tier" | "`var'" == "Nmedlistingpricepsqf
> t_top_tier" {
 58.                         local label_zillow = `"`label_zillow' "(N)""'
 59.                 }
 60.                 if "`var'" == "medrentpricepsqft_2br" {
 61.                         local label_zillow = `"`label_zillow' "Median Rent psqft 2BR""'
 62.                 }
 63.                 if "`var'" == "medrentpricepsqft_mfr5plus" {
 64.                         local label_zillow = `"`label_zillow' "Median Rent psqft MFR5PLUS""'
 65.                 }
 66.                 if "`var'" == "medlistingpricepsqft_sfcc" {
 67.                         local label_zillow = `"`label_zillow' "Median Listing psqft SFCC""'
 68.                 }
 69.                 if "`var'" == "medlistingpricepsqft_low_tier" {
 70.                         local label_zillow = `"`label_zillow' "Median Listing psqft 5-35th pct""'
 71.                 }
 72.                 if "`var'" == "medlistingpricepsqft_top_tier" {
 73.                         local label_zillow = `"`label_zillow' "Median Listing psqft 65-95th pct""'
 74.                 }
 75.         }
 76.         di `label_zillow'
 77.                 
.         local rownames =  `" "zipcode" "(\%)" "population (Million)" "(\%)"  "housing units (Million)" "(\%)"  "median income"  "Ho
> uses for rent (\%)" "Urban population (\%)" "College Educated (\%)" "Black population (\%)" "Hispanic population (\%)" "Pop. in pov
> erty (\%)" "Children 0-5 (\%)" "Elders 65+ (\%)" "Unemployed (\%)" "Work in same County (\%)" "MW events" "Salient MW events" "Fed 
> MW event" "State MW event" "County MW Event" "Local MW Event" "'
 78. 
.         foreach var of local label_zillow {
 79.                 local rownames =  `" `rownames' "`var'" "' 
 80.         }
 81. 
.         mat rowname t = `rownames'
 82. 
.         mat colname t = "U.S." "Full Panel" "Listing Panel" "Rent Panel" 
 83. 
.         mat list t 
 84.         esttab matrix(t) using ../output/desc_stats.tex, replace 
 85. end

. 
. 
. 
. 
. program create_stats_final_dsets
  1.         syntax, target_zillow(str)
  2.         replace sal_mw_event =. if missing(mw_event)    
  3. 
.         local target_zillow_count = ""
  4.         foreach var of local target_zillow {
  5.                 local newvar "N`var' = `var'"
  6.                 local target_zillow_count = `" `target_zillow_count' `newvar' "'
  7.         }
  8. 
.         collapse (sum)  mw_event sal_mw_event fed_event state_event county_event local_event ///
>                          (mean)  `target_zillow' ///
>                          (count) `target_zillow_count' ///
>                          (first) pop2010 housing_units2010 urb_share2010 college_share2010 poor_share20105 black_share2010 hisp_sha
> re2010 child_share2010 elder_share2010 unemp_share20105 med_hhinc20105 renthouse_share2010 work_county_share20105 ///
>                          , by(zipcode)  
  9.         local target_zillow_N = ""
 10.         foreach var of local target_zillow {
 11.                 local newvar "N`var'"
 12.                 local target_zillow_N = `" `target_zillow_N' `newvar' "'
 13.         }
 14. 
.         foreach var in `target_zillow_N' {
 15.                 replace `var' = . if `var'==0
 16.         } 
 17. 
.         collapse (sum)  pop2010 housing_units2010 ///
>                          (mean)  urb_share2010 college_share2010 poor_share20105 black_share2010 hisp_share2010 ///
>                                      child_share2010 elder_share2010 unemp_share20105 med_hhinc20105 renthouse_share2010 work_count
> y_share20105 ///
>                                      mw_event sal_mw_event fed_event state_event county_event local_event ///
>                                      `target_zillow'  ///
>                          (count) zipcode `target_zillow_N'
 18. 
. 
.         merge 1:1 _n using ../temp/us_totals, nogen assert(1 2 3)
 19. 
.         g pop_sh = pop2010/USpop
 20.         g housing_units_sh = housing_units2010/UShousing_units
 21.         g zipcode_sh = zipcode/USzipcode
 22. 
.         drop USpop UShousing_units USzipcode
 23. 
.         order zipcode zipcode_sh pop2010 pop_sh housing_units2010 housing_units_sh med_hhinc20105 renthouse_share2010 urb_share2010
>  college_share2010 black_share2010 hisp_share2010 poor_share20105 child_share2010 elder_share2010 unemp_share20105 work_county_shar
> e20105 mw_event sal_mw_event fed_event state_event county_event local_event
 24. 
. end

. 
. 
. 
. main 
(34 vars, 38,893 obs)
(note: file ../temp/us_panel_stats_zipcode.dta not found)
file ../temp/us_panel_stats_zipcode.dta saved
(note: file ../temp/us_totals.dta not found)
file ../temp/us_totals.dta saved
(0 real changes made)
(1,032 real changes made, 1,032 to missing)
(888 real changes made, 888 to missing)
(162 real changes made, 162 to missing)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 1  
    -----------------------------------------
(note: file ../temp/rent_panel_stats_zipcode.dta not found)
file ../temp/rent_panel_stats_zipcode.dta saved
(2 real changes made, 2 to missing)
(739 real changes made, 739 to missing)
(5,553 real changes made, 5,553 to missing)
(4,071 real changes made, 4,071 to missing)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 1  
    -----------------------------------------
(note: file ../temp/listing_panel_stats_zipcode.dta not found)
file ../temp/listing_panel_stats_zipcode.dta saved
(319,304 real changes made, 319,304 to missing)
(29,890 real changes made, 29,890 to missing)
(28,916 real changes made, 28,916 to missing)
(28,965 real changes made, 28,965 to missing)
(21,406 real changes made, 21,406 to missing)
(28,535 real changes made, 28,535 to missing)
(26,857 real changes made, 26,857 to missing)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                 1  
    -----------------------------------------
(note: file ../temp/yearmonth_panel_stats_zipcode.dta not found)
file ../temp/yearmonth_panel_stats_zipcode.dta saved
(4 real changes made)
(4 real changes made)
 medrentpricepsqft_2br Nmedrentpricepsqft_2br medrentpricepsqft_mfr5plus Nmedrentpricepsqft_mfr5plus medrentpricepsqft_sfcc Nmedrentp
> ricepsqft_sfcc medlistingpricepsqft_sfcc Nmedlistingpricepsqft_sfcc medlistingpricepsqft_low_tier Nmedlistingpricepsqft_low_tier me
> dlistingpricepsqft_top_tier Nmedlistingpricepsqft_top_tier
Median Rent psqft 2BR(N)Median Rent psqft MFR5PLUS(N)Median Rent psqft SFCC(N)Median Listing psqft SFCC(N)Median Listing psqft 5-35th
>  pct(N)Median Listing psqft 65-95th pct(N)

t[35,4]
                      U.S.    Full Panel  Listing Pa~l    Rent Panel
     zipcode         38893         32281          7699          1305
        (\%)             1           .83          .198          .034
  population(
    Million)       311.177       305.073       194.522        50.619
        (\%)             1           .98          .625          .163
housing un~)       132.833       130.259        81.299        21.323
        (\%)             1          .981          .612          .161
median inc~e         52493         53007         63721         66920
Houses for~)          .295           .26          .305          .383
Urban popu~)          .464          .408           .82          .972
College Ed~)          .314          .305          .392          .445
Black popu~)          .086          .076          .094          .166
Hispanic p~)          .097          .088          .133          .192
Pop. in po~)          .154          .144          .124          .133
Children 0~)          .185          .189          .195          .199
Elders 65+~)           .15          .154          .139           .11
  Unemployed(
         \%)          .089          .086          .087          .092
Work in sa~)          .701          .683           .72          .756
   MW events             .         8.425         3.703         4.063
Salient MW~s             .         4.487         1.669         1.609
Fed MW event             .          .322             0             0
State MW e~t             .         7.805          3.23         3.599
County MW ~t             .          .165          .277           .12
Local MW E~t             .          .133          .197          .344
Median Ren~R             .         1.628             .         1.871
         (N)             .          2391             .           273
Median Ren~S             .         1.664             .         1.868
         (N)             .          3365             .           417
Median Ren~C             .         1.372             .         1.213
         (N)             .          3316             .          1143
Median Lis~C             .       171.534       161.503             .
         (N)             .         10875          6960             .
Median Lis~t             .       130.741       126.098             .
         (N)             .          3746          2146             .
Median Lis~t             .       220.607       193.331             .
         (N)             .          5424          3628             .
(note: file ../output/desc_stats.tex not found)
(output written to ../output/desc_stats.tex)

. 
end of do-file

 make.py ended: 2020-09-06 13:11:42
