
 make.py started: 2024-07-23 18:29:41 C:\Users\el_he\Documents\GitHub\min_wage_rent\base\min_wage\code 




Execute:  StataSE-64 /e do "./state_mw.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        https://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Stata license: 120-user network perpetual
Serial number: 401606201670
  Licensed to: Brown University
               Brown University

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000; see help set_maxvar.

. do ./state_mw.do 

. set more off

. clear all

. adopath + ../../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata16\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata16\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\el_he\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../lib/stata/gslab_misc/ado"

. 
. program main
  1.     local raw     "../../../drive/raw_data/min_wage"
  2.     local xwalk   "../../../raw/crosswalk"
  3.     local outstub "../output"
  4.     local temp    "../temp"
  5. 
.     import_statenames, instub(`xwalk') outstub(`temp')
  6.     local fips = r(fips)
  7. 
.     fed_min_wage_change,   instub(`raw') outstub(`temp') 
  8.     add_state_to_fedmw,    fips(`fips')  outstub(`temp')
  9.     state_min_wage_change, instub(`raw') outstub(`temp') temp(`temp')
 10. 
.     prepare_finaldata, begindate(01may1974) finaldate(31Dec2024)           //
> /
>                        outstub(`temp') temp(`temp')
 11. 
.     local mw_list "fed_mw mw"
 12.     export_state_daily,     instub(`temp') outstub(`outstub') target_mw(`m
> w_list')
 13.     export_state_monthly,   instub(`temp') outstub(`outstub') target_mw(`m
> w_list')
 14.     export_state_quarterly, instub(`temp') outstub(`outstub') target_mw(`m
> w_list')
 15.     export_state_yearly,    instub(`temp') outstub(`outstub') target_mw(`m
> w_list')
 16. end

. 
. program import_statenames, rclass
  1.     syntax, instub(str) outstub(str)
  2. 
.     import excel using `instub'/state_name_fips_usps.xlsx, clear ///
>         firstrow
  3. 
.     rename (Name       FIPSStateNumericCode  OfficialUSPSCode)           ///
>            (statename  statefips             stateabb)
  4.     drop sname
  5. 
.     label var stateabb "State"
  6. 
.     save_data `outstub'/crosswalk.dta, replace key(statefips) log(none)
  7. 
.     levelsof statefips, local(fips)
  8.     return local fips "`fips'"
  9. end

. 
. program fed_min_wage_change
  1.     syntax, instub(str) outstub(str)
  2. 
.     import excel using `instub'/VZ_FederalMinimumWage_Changes.xlsx, clear fir
> strow
  3.     rename Fed_mw fed_mw
  4.     keep year month day fed_mw source
  5. 
.     gen date = mdy(month, day, year)
  6.     format date %td
  7. 
.     replace fed_mw = round(fed_mw, .01)
  8.     label var fed_mw "Federal Minimum Wage"
  9. 
.     order year month day date fed_mw source
 10. 
.     export delim using `outstub'/VZ_federal_changes.csv, replace
 11. end

. 
. program add_state_to_fedmw
  1.     syntax, fips(str) outstub(str)
  2.     
.     tsset date
  3.     tsfill
  4. 
.     carryforward year month day fed_mw, replace
  5. 
.     keep date fed_mw
  6. 
.     tempfile temp
  7.     save `temp'
  8.     
.     foreach i in `fips' {
  9.         use `temp', clear
 10.         gen statefips = `i'
 11.         tempfile state`i'
 12.         save `state`i''
 13.     }
 14.     foreach i in `fips' {
 15.         if `i' == 1 use `state`i'', clear
 16.         else quietly append using `state`i''
 17.     }
 18. 
.     compress
 19. 
.     save_data `outstub'/fedmw.dta, ///
>             replace key(date statefips) log(none)
 20. end

. 
. program state_min_wage_change
  1.     syntax, instub(str) outstub(str) temp(str)
  2. 
.     import excel using `instub'/VZ_StateMinimumWage_Changes.xlsx, clear first
> row
  3. 
.     gen date = mdy(month,day,year)
  4.     format date %td
  5. 
.     gen double mw = round(VZ_mw, .01)
  6.     gen double mw_healthinsurance = round(VZ_mw_healthinsurance, .01)
  7.     gen double mw_smallbusiness   = round(VZ_mw_smallbusiness, .01)
  8.     drop VZ_mw*
  9. 
.     merge m:1 statefips using `temp'/crosswalk.dta, nogen assert(3)
 10. 
.     order statefips statename stateabb year month day date mw* ///
>         source source_2 source_notes
 11.     label var statefips "State FIPS Code"
 12.     label var statename "State"
 13. 
.     sort stateabb date
 14.     
.     export delim using `outstub'/VZ_state_changes.csv, replace 
 15. 
.     tsset statefips date
 16.     tsfill
 17. 
.     keep statefips date mw* source_notes
 18. 
.     foreach x of varlist source_notes {
 19.         bysort statefips (date): replace `x' = `x'[_n-1] if `x' == ""
 20.     }
 21.     foreach x of varlist mw* {
 22.         bysort statefips (date): replace `x' = `x'[_n-1] if `x' == .
 23.     }
 24. end 

. 
. program prepare_finaldata    
  1.     syntax, begindate(str) finaldate(str) outstub(str) temp(str)
  2. 
.     merge 1:1 statefips date using `temp'/fedmw.dta, nogen
  3.     merge m:1 statefips using `temp'/crosswalk.dta, nogen assert(3)
  4. 
.     gen mw_adj = mw
  5.     replace mw_adj = fed_mw if fed_mw >= mw & fed_mw ~= .
  6.     replace mw_adj = fed_mw if mw == . & fed_mw ~= .
  7.     drop mw
  8.     rename mw_adj mw
  9. 
.     keep if date >= td(`begindate') & date <= td(`finaldate')
 10. 
.     order statefips statename stateabb date fed_mw mw
 11.     label var mw "State Minimum Wage"
 12.     notes mw: The mw variable represents the higher rate between the state
>  and federal minimum wage
 13. 
.     save_data `outstub'/data_state.dta, replace key(statefips date) log(none)
 14. end

. 
. program export_state_monthly
  1.     syntax, instub(str) outstub(str) target_mw(str)
  2. 
.     use `instub'/data_state.dta, clear
  3. 
.     keep statefips statename stateabb date `target_mw'
  4. 
.     gen monthly_date = mofd(date)
  5.     format monthly_date %tm
  6. 
.     collapse (max) `target_mw', by(statefips statename stateabb monthly_date)
  7. 
.     label var monthly_date "Monthly Date"
  8.     label_mw_vars, time_level("Monthly")
  9. 
.     save_data `outstub'/state_monthly.csv, key(statefips monthly_date) ///
>         outsheet replace
 10. end

. 
. program export_state_quarterly
  1.     syntax, instub(str) outstub(str) target_mw(str)
  2. 
.     use `instub'/data_state.dta, clear
  3. 
.     keep statefips statename stateabb date `target_mw'
  4. 
.     gen quarterly_date = qofd(date)
  5.     format quarterly_date %tq
  6. 
.     collapse (max) `target_mw', by(statefips statename stateabb quarterly_dat
> e)
  7. 
.     label var quarterly_date "Quarterly Date"
  8.     label_mw_vars, time_level("Quarterly")
  9. 
.     save_data `outstub'/state_quarterly.csv, key(statefips quarterly_date) //
> /
>         outsheet replace
 10. end

. 
. program export_state_yearly
  1.     syntax, instub(str) outstub(str) target_mw(str)
  2. 
.     use `instub'/data_state.dta, clear
  3. 
.     keep statefips statename stateabb date `target_mw'
  4. 
.     gen year = yofd(date)
  5.     format year %ty
  6. 
.     collapse (max) `target_mw', by(statefips statename stateabb year)
  7. 
.     label var year "Year"
  8.     label_mw_vars, time_level("Annual")
  9. 
.     save_data `outstub'/state_annual.csv, key(statefips year) ///
>         outsheet replace
 10. end

. 
. program export_state_daily
  1.     syntax, instub(str) outstub(str) target_mw(str)
  2. 
.     use `instub'/data_state.dta, clear
  3. 
.     keep statefips statename stateabb date `target_mw'
  4. 
.     save_data `outstub'/state_daily.csv, key(statefips date) ///
>         outsheet replace
  5. end

. 
. program label_mw_vars
  1.     syntax, time_level(str)
  2. 
.     cap label var fed_mw  "`time_level' Federal MW"
  3.     cap label var mw      "`time_level' State MW"       
  4.     cap label var mw_healthinsurance "`time_level' State MW Health and Ins
> urance"
  5.     cap label var mw_smallbusiness   "`time_level' State MW Small Business
> "
  6. end

. 
. *EXECUTE
. main 
(4 vars, 51 obs)
(data now sorted by statefips)
  (0 bytes saved)
===============================================================================
> ===================
File: ../temp/crosswalk.dta
Key: statefips
===============================================================================
> ===================
  51:3(102890):1997375568:263623840

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |         51    28.96078    15.83283          1         56
   statename |          0
    stateabb |          0




(note: file ../temp/crosswalk.dta not found)
file ../temp/crosswalk.dta saved
1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32
>  33 34 35 36 37 38 39 40 41 42 44 45 46 47 48 49 50 51 53 54 55 56
(1,024 vars, 15 obs)
(3 real changes made)
(note: file ../temp/VZ_federal_changes.csv not found)
file ../temp/VZ_federal_changes.csv saved
        time variable:  date, 01may1974 to 31dec2024, but with gaps
                delta:  1 day
year:  (18,493 real changes made)
month:  (18,493 real changes made)
day:  (18,493 real changes made)
fed_mw:  (18,493 real changes made)
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000001.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000002.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000003.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000004.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000005.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000006.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000007.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000008.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000009.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000a.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000b.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000c.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000d.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000e.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000f.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000g.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000h.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000i.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000j.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000k.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000l.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000m.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000n.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000o.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000p.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000q.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000r.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000s.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000t.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000u.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000v.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000w.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00000x.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000010.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000011.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000012.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000013.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000014.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000015.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000016.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000017.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000018.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_000019.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001a.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001b.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001c.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001d.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001e.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001f.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001g.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001h.tmp saved
file C:\Users\el_he\AppData\Local\Temp\ST_3808_00001i.tmp saved
  variable date was float now int
  variable statefips was float now byte
  (4,719,540 bytes saved)
(data now sorted by date statefips)
  (0 bytes saved)
===============================================================================
> ===================
File: ../temp/fedmw.dta
Key: date statefips
===============================================================================
> ===================
  943908:3(96450):1120187329:476544774

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        date |    943,908     14487.5    5342.802       5234      23741
   statefips |    943,908    28.96078    15.67684          1         56
      fed_mw |    943,908    5.022728     1.74236          2       7.25




(note: file ../temp/fedmw.dta not found)
file ../temp/fedmw.dta saved
(22 vars, 799 obs)
(781 missing values generated)
(745 missing values generated)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               799  
    -----------------------------------------
(note: file ../temp/VZ_state_changes.csv not found)
file ../temp/VZ_state_changes.csv saved
       panel variable:  statefips (unbalanced)
        time variable:  date, 08feb1943 to 01jan2028, but with gaps
                delta:  1 day
(127,069 real changes made)
(660,214 real changes made)
(8,784 real changes made)
(36,871 real changes made)

    Result                           # of obs.
    -----------------------------------------
    not matched                       417,963
        from master                    67,534  
        from using                    350,429  

    matched                           593,479  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,011,442  
    -----------------------------------------
(350,429 missing values generated)
(82,021 real changes made)
(350,429 real changes made)
(67,534 observations deleted)
(data now sorted by statefips date)
  variable date was float now int
  (1,887,816 bytes saved)
===============================================================================
> ===================
File: ../temp/data_state.dta
Key: statefips date
===============================================================================
> ===================
  943908:9(106708):4218698352:1977302378

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |    943,908    28.96078    15.67684          1         56
        date |    943,908     14487.5    5342.802       5234      23741
   statename |          0
    stateabb |          0
      fed_mw |    943,908    5.022728     1.74236          2       7.25
-------------+---------------------------------------------------------
          mw |    943,908    5.534491    2.548753          2       17.5
mw_healthi~e |      8,436    8.476468    2.302437       5.15      13.73
mw_smallbu~s |     36,924    6.340223    2.782632          4         15
source_notes |          0




(note: file ../temp/data_state.dta not found)
file ../temp/data_state.dta saved
(data already sorted by statefips date)
  (0 bytes saved)
===============================================================================
> ===================
File: ../output/state_daily.csv
Key: statefips date
===============================================================================
> ===================
  943908:6(105292):4272096590:2790197816

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |    943,908    28.96078    15.67684          1         56
        date |    943,908     14487.5    5342.802       5234      23741
   statename |          0
    stateabb |          0
      fed_mw |    943,908    5.022728     1.74236          2       7.25
-------------+---------------------------------------------------------
          mw |    943,908    5.534491    2.548753          2       17.5




(note: file ../output/state_daily.csv not found)
(data now sorted by statefips monthly_date)
  variable monthly_date was float now int
  (62,016 bytes saved)
===============================================================================
> ===================
File: ../output/state_monthly.csv
Key: statefips monthly_date
===============================================================================
> ===================
  31008:6(88358):3023100040:2077976239

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |     31,008    28.96078    15.67709          1         56
monthly_date |     31,008       475.5    175.5171        172        779
   statename |          0
    stateabb |          0
      fed_mw |     31,008    5.025329    1.743941          2       7.25
-------------+---------------------------------------------------------
          mw |     31,008    5.536109    2.549605          2       17.5




(note: file ../output/state_monthly.csv not found)
(data now sorted by statefips quarterly_date)
  variable quarterly_date was float now int
  (20,706 bytes saved)
===============================================================================
> ===================
File: ../output/state_quarterly.csv
Key: statefips quarterly_date
===============================================================================
> ===================
  10353:6(75918):486878879:4070786573

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |     10,353    28.96078    15.67759          1         56
quarterly_~e |     10,353         158    58.60317         57        259
   statename |          0
    stateabb |          0
      fed_mw |     10,353    5.021675    1.746812          2       7.25
-------------+---------------------------------------------------------
          mw |     10,353     5.53342    2.553769          2       17.5




(note: file ../output/state_quarterly.csv not found)
(data now sorted by statefips year)
  variable year was float now int
  (5,202 bytes saved)
===============================================================================
> ===================
File: ../output/state_annual.csv
Key: statefips year
===============================================================================
> ===================
  2601:6(71699):355437462:1456941638

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |      2,601    28.96078    15.67985          1         56
        year |      2,601        1999    14.72243       1974       2024
   statename |          0
    stateabb |          0
      fed_mw |      2,601    5.043137    1.763831          2       7.25
-------------+---------------------------------------------------------
          mw |      2,601    5.555359     2.57922          2       17.5




(note: file ../output/state_annual.csv not found)

. 
end of do-file


Execute:  StataSE-64 /e do "./substate_mw.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        https://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Stata license: 120-user network perpetual
Serial number: 401606201670
  Licensed to: Brown University
               Brown University

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000; see help set_maxvar.

. do ./substate_mw.do 

. set more off

. clear all

. adopath + ../../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata16\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata16\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "C:\Users\el_he\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../lib/stata/gslab_misc/ado"

. 
. program main 
  1.     local raw     "../../../drive/raw_data/min_wage"
  2.     local xwalk   "../../../raw/crosswalk"
  3.     local outstub "../output"
  4.     local temp    "../temp"
  5. 
.     local enddate "31Dec2024"
  6. 
.     import_crosswalk, instub(`xwalk') outstub(`temp')
  7. 
.     substate_min_wage_change, instub(`raw') outstub(`temp') temp(`temp')
  8.     prepare_local, temp(`temp')
  9.     prepare_state, outstub(`outstub') temp(`temp') finaldate(`enddate')
 10. 
.     local mw_list = "mw mw_smallbusiness"
 11.     prepare_finaldata, temp(`temp') finaldate(`enddate') target_mw(`mw_lis
> t')
 12. 
.     export_substate_monthly,   outstub(`outstub') temp(`temp') target_mw(`mw_
> list')
 13.     export_substate_quarterly, outstub(`outstub') temp(`temp') target_mw(`
> mw_list')
 14.     export_substate_yearly,    outstub(`outstub') temp(`temp') target_mw(`
> mw_list')
 15. end

. 
. program import_crosswalk
  1.     syntax, instub(str) outstub(str)
  2.     import excel using `instub'/state_name_fips_usps.xlsx, clear firstrow 
  3. 
.     rename Name statename
  4.     rename FIPSStateNumericCode statefips
  5.     rename OfficialUSPSCode stateabb
  6.     replace stateabb = upper(stateabb)
  7.     label var stateabb "State Abbreviation"
  8. 
.     keep statename statefips stateabb
  9. 
.     save `outstub'/crosswalk.dta, replace
 10. end

. 
. program substate_min_wage_change
  1.     syntax, instub(str) outstub(str) temp(str)
  2. 
.     import excel using `instub'/VZ_SubstateMinimumWage_Changes.xlsx, clear fi
> rstrow
  3. 
.     gen date = mdy(month,day,year)
  4.     format date %td
  5. 
.     gen double mw                 = round(VZ_mw, .01)
  6.     gen double mw_healthinsurance = round(VZ_mw_healthinsurance, .01)
  7.     gen double mw_macrobusiness   = round(VZ_mw_macrobusiness, .01)
  8.     gen double mw_mediumbusiness  = round(VZ_mw_mediumbusiness, .01)
  9.     gen double mw_smallbusiness   = round(VZ_mw_smallbusiness, .01)
 10.     gen double mw_smallbusiness_mincomp = round(VZ_mw_smallbusiness_mincom
> pensat, .01)
 11.     gen double mw_hotel           = round(VZ_mw_hotel, .01)
 12.     gen double mw_nonprofit       = round(VZ_mw_nonprofit, .01)
 13.     gen double mw_tipped          = round(VZ_mw_tipped, .01)
 14.     drop VZ_mw*
 15. 
.     egen min_mw  = rowmin(mw-mw_tipped)
 16.     egen mean_mw = rowmean(mw-mw_tipped)
 17.     egen max_mw  = rowmax(mw-mw_tipped)
 18. 
.     merge m:1 statefips using `temp'/crosswalk.dta, nogen keep(3)
 19.     label var statefips "State FIPS Code"
 20.     label var statename "State"
 21.     label var stateabb "State Abbreviation"
 22.     label var locality "City/County"
 23.     label var mw "Minimum Wage"
 24.     order statefips statename stateabb locality year month day date mw ///
>         mw_* source source_2 source_notes
 25. 
.     export delim using `outstub'/VZ_substate_changes.csv, replace 
 26. end

. 
. program prepare_local
  1.     syntax, temp(str)
  2.     preserve
  3.         egen tag = tag(statefips locality)
  4.         keep if tag == 1
  5.         keep statefips locality
  6. 
.         save `temp'/localities.dta, replace
  7.     restore
  8. end

. 
. program prepare_state
  1.     syntax, outstub(str) temp(str) finaldate(str)
  2. 
.     sum year
  3.     local minyear = r(min)
  4. 
.     preserve    
  5.         import delim `outstub'/state_daily.csv, clear 
  6. 
.         gen date2 = date(date, "DMY")
  7.         format date2 %td
  8.         order date2, after(date)
  9.         drop date 
 10.         rename date2 date
 11. 
.         keep if year(date) >= `minyear' & date <= td(`finaldate')
 12.         joinby statefips using `temp'/localities.dta
 13.         keep statefips statename stateabb locality date mw
 14. 
.         rename mw state_mw
 15.         save `temp'/statemw.dta, replace
 16.     restore
 17. end

. 
. program prepare_finaldata
  1.     syntax, temp(str) finaldate(str) target_mw(str)
  2. 
.     encode locality, gen(locality_temp)
  3. 
.     tsset locality_temp date
  4.     tsfill
  5. 
.     foreach x of varlist statename stateabb locality source_notes {
  6.         bysort locality_temp (date): replace `x' = `x'[_n-1] if `x' == ""
  7.     }
  8.     foreach x of varlist statefips mw* {
  9.         bysort locality_temp (date): replace `x' = `x'[_n-1] if `x' == .
 10.     }
 11. 
.     keep if date <= td(`finaldate')
 12. 
.     merge 1:m statefips locality date using "`temp'/statemw.dta", ///
>         assert(2 3) nogen
 13. 
.     replace mw = state_mw if mw == .
 14.     replace mw = round(mw,0.01)
 15.     gen abovestate_mw = mw > state_mw
 16.     label var abovestate_mw "Local `var' > State min wage"
 17. 
.     local mw "mw"
 18.     local new_target_mw: list target_mw - mw 
 19. 
.     foreach var in `new_target_mw' {
 20.         replace `var' = mw if `var' == .
 21.         replace `var' = round(`var', 0.01)
 22.         gen abovestate_`var' = `var' > state_mw
 23.         label var abovestate_`var' "Local `var' > State min wage"         
>       
 24.     }
 25. 
.     keep statefips statename stateabb date locality mw mw_* abovestate_*  sou
> rce_notes
 26.     order statefips statename stateabb date locality mw mw_* abovestate_* 
>   source_notes
 27.     notes mw: The mw variable represents the most applicable minimum wage 
> across the locality.
 28. 
.     save_data `temp'/data_substate.dta, key(statefips locality date) replace 
> log(none)
 29. end

. 
. program export_substate_monthly
  1.     syntax, outstub(str) temp(str) target_mw(str)
  2.     use `temp'/data_substate.dta, clear
  3. 
.     gen monthly_date = mofd(date)
  4.     format monthly_date %tm
  5. 
.     collapse (max) `target_mw' abovestate_*, ///
>         by(statefips statename stateabb locality monthly_date)
  6. 
.     label var monthly_date "Monthly Date"
  7.     label_mw_vars, time_level("Monthly")
  8. 
.     fix_name_locality
  9. 
.     save_data `outstub'/substate_monthly.csv, key(locality monthly_date) ///
>         outsheet replace
 10. end 

. 
. program export_substate_quarterly
  1.     syntax, outstub(str) temp(str) target_mw(str)
  2.     use `temp'/data_substate.dta, clear
  3. 
.     gen quarterly_date = qofd(date)
  4.     format quarterly_date %tq
  5. 
.     collapse (max) `target_mw' abovestate_*, ///
>         by(statefips statename stateabb locality quarterly_date)
  6. 
.     label var quarterly_date "Quarterly Date"
  7.     label_mw_vars, time_level("Quarterly")
  8. 
.     fix_name_locality
  9. 
.     save_data `outstub'/substate_quarterly.csv, key(locality quarterly_date) 
> ///
>         outsheet replace
 10. end 

. 
. program export_substate_yearly
  1.     syntax, outstub(str) temp(str) target_mw(str)
  2.     use `temp'/data_substate.dta, clear
  3. 
.     gen year = yofd(date)
  4.     format year %ty
  5. 
.     collapse (max) `target_mw' abovestate_*, ///
>         by(statefips statename stateabb locality year)
  6. 
.     label var year "Year"
  7.     label_mw_vars, time_level("Annual")
  8. 
.     fix_name_locality
  9. 
.     save_data `outstub'/substate_annual.csv, key(locality year) ///
>         outsheet replace
 10. end

. 
. program label_mw_vars
  1.     syntax, time_level(str)
  2. 
.     cap label var mw     "`time_level' MW"      
  3.     cap label var abovestate_mw "Local > State min wage"        
  4.     cap label var mw_healthinsurance "`time_level' State MW Health and Ins
> urance"
  5.     cap label var mw_smallbusiness   "`time_level' State MW Small Business
> "
  6. end

. 
. program fix_name_locality
  1.     // Fixes to assure names of places match with LODES data
. 
.     replace locality = "New York"         if locality == "New York City"
  2.     replace locality = "St. Paul"         if locality == "Saint Paul"
  3.     replace locality = "Daly City"        if locality == "Daly city"
  4.     replace locality = locality + " city" if strpos(locality, "County") ==
>  0
  5. 
.     replace locality = "Lexington-Fayette urban county" if locality == "Lexin
> gton city"
  6. 
.     replace locality = locality + ", " + stateabb
  7. end

. 
. * EXECUTE
. main 
(4 vars, 51 obs)
(0 real changes made)
file ../temp/crosswalk.dta saved
(18 vars, 1,249 obs)
(647 missing values generated)
(648 missing values generated)
(1,249 missing values generated)
(1,226 missing values generated)
(1,225 missing values generated)
(1,111 missing values generated)
(1,237 missing values generated)
(1,227 missing values generated)
(1,240 missing values generated)
(1,174 missing values generated)
(647 missing values generated)
(647 missing values generated)
(647 missing values generated)
(note: variable statename was str10, now str20 to accommodate using data's
       values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               602  
    -----------------------------------------
(note: file ../temp/VZ_substate_changes.csv not found)
file ../temp/VZ_substate_changes.csv saved
(527 observations deleted)
(note: file ../temp/localities.dta not found)
file ../temp/localities.dta saved

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        year |        602    2020.085    3.761323       2004       2025
(6 vars, 943,908 obs)
(552,687 observations deleted)
(note: file ../temp/statemw.dta not found)
file ../temp/statemw.dta saved
       panel variable:  locality_temp (unbalanced)
        time variable:  date, 01jan2004 to 01jan2025, but with gaps
                delta:  1 day
(205,029 real changes made)
(205,029 real changes made)
(205,029 real changes made)
(84,172 real changes made)
(205,029 real changes made)
(204,848 real changes made)
(0 real changes made)
(4,728 real changes made)
(5,453 real changes made)
(46,365 real changes made)
(4,647 real changes made)
(7,286 real changes made)
(2,913 real changes made)
(26,052 real changes made)
(2 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       369,696
        from master                         0  
        from using                    369,696  

    matched                           205,629  
    -----------------------------------------
(369,878 real changes made)
(92,007 real changes made)
(528,822 real changes made)
(0 real changes made)
(data now sorted by statefips locality date)
  variable date was float now int
  variable abovestate_mw was float now byte
  variable abovestate_mw_smallbusiness was float now byte
  variable mw_healthinsurance was double now byte
  variable statename was str20 now str10
  (14,383,125 bytes saved)
===============================================================================
> ===================
File: ../temp/data_substate.dta
Key: statefips locality date
===============================================================================
> ===================
  575325:17(32428):2535987797:3921035542

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |    575,325    16.38667    15.57854          4         53
    locality |          0
        date |    575,325       19906    2214.429      16071      23741
   statename |          0
    stateabb |          0
-------------+---------------------------------------------------------
          mw |    575,325     10.0167    3.425733       5.15      20.29
mw_healthi~e |          0
mw_macrobu~s |      4,750     14.1546    2.364622         10      20.29
mw_mediumb~s |      5,477    14.34702    2.310272         10      19.29
mw_smallbu~s |    575,325    9.940859    3.333485       5.15      20.29
-------------+---------------------------------------------------------
mw_smallbu~p |      4,659    15.20589    2.105153         11      19.08
    mw_hotel |      7,308    16.94429    1.569211      13.25      20.32
mw_nonprofit |      2,922    14.66367    2.267974       10.5      17.35
   mw_tipped |     26,127    6.664737    3.292317       3.25       15.9
abovestate~w |    575,325     .363857    .4811086          0          1
-------------+---------------------------------------------------------
abovestate~s |    575,325    .3432425     .474792          0          1
source_notes |          0




(note: file ../temp/data_substate.dta not found)
file ../temp/data_substate.dta saved
(252 real changes made)
(252 real changes made)
(252 real changes made)
variable locality was str22 now str24
(15,624 real changes made)
variable locality was str24 now str30
(252 real changes made)
variable locality was str30 now str34
(18,900 real changes made)
(data now sorted by locality monthly_date)
  variable monthly_date was float now int
  (37,800 bytes saved)
===============================================================================
> ===================
File: ../output/substate_monthly.csv
Key: locality monthly_date
===============================================================================
> ===================
  18900:9(81157):493564932:971399347

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    locality |          0
monthly_date |     18,900       653.5    72.74749        528        779
   statefips |     18,900    16.38667    15.57894          4         53
   statename |          0
    stateabb |          0
-------------+---------------------------------------------------------
          mw |     18,900    10.01725    3.424627       5.15      20.29
mw_smallbu~s |     18,900    9.941416    3.332387       5.15      20.29
abovestate~w |     18,900    .3642857     .481242          0          1
abovestate~s |     18,900    .3436508    .4749388          0          1




(note: file ../output/substate_monthly.csv not found)
(84 real changes made)
(84 real changes made)
(84 real changes made)
variable locality was str22 now str24
(5,208 real changes made)
variable locality was str24 now str30
(84 real changes made)
variable locality was str30 now str34
(6,300 real changes made)
(data now sorted by locality quarterly_date)
  variable quarterly_date was float now int
  (12,600 bytes saved)
===============================================================================
> ===================
File: ../output/substate_quarterly.csv
Key: locality quarterly_date
===============================================================================
> ===================
  6300:9(28147):2338820180:1910158409

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    locality |          0
quarterly_~e |      6,300       217.5    24.24892        176        259
   statefips |      6,300    16.38667    15.57976          4         53
   statename |          0
    stateabb |          0
-------------+---------------------------------------------------------
          mw |      6,300    10.02101    3.424409       5.15      20.29
mw_smallbu~s |      6,300    9.945175    3.332239       5.15      20.29
abovestate~w |      6,300    .3655556    .4816238          0          1
abovestate~s |      6,300    .3449206    .4753801          0          1




(note: file ../output/substate_quarterly.csv not found)
(21 real changes made)
(21 real changes made)
(21 real changes made)
variable locality was str22 now str24
(1,302 real changes made)
variable locality was str24 now str30
(21 real changes made)
variable locality was str30 now str34
(1,575 real changes made)
(data now sorted by locality year)
  variable year was float now int
  (3,150 bytes saved)
===============================================================================
> ===================
File: ../output/substate_annual.csv
Key: locality year
===============================================================================
> ===================
  1575:9(67984):3873822176:2213651866

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    locality |          0
        year |      1,575        2014    6.057224       2004       2024
   statefips |      1,575    16.38667    15.58347          4         53
   statename |          0
    stateabb |          0
-------------+---------------------------------------------------------
          mw |      1,575    10.09979    3.452198       5.15      20.29
mw_smallbu~s |      1,575     10.0234    3.360222       5.15      20.29
abovestate~w |      1,575    .3866667    .4871409          0          1
abovestate~s |      1,575     .367619      .48231          0          1




(note: file ../output/substate_annual.csv not found)

. 
end of do-file

 make.py ended: 2024-07-23 18:30:54
