
 make.py started: 2022-02-28 06:08:15 C:\Users\diegog\Desktop\Diego\min_wage_rent\base\census_block_master\code 




Execute:  StataMP-64 /e do "./spatial_match.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 32-core Stata perpetual license:
       Serial number:  501506205566
         Licensed to:  KU Leuven FEB (CES)
                       KU Leuven

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do ./spatial_match.do 

. clear all

. set more off

. adopath + ../../../lib/stata/min_wage/ado
  [1]  (BASE)      "C:\Program Files\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../lib/stata/min_wage/ado"

. 
. program main
  1.     local in_shp    "../../../drive/base_large/shp_to_dta"
  2.     local in_xwalk  "../../../drive/raw_data/census_crosswalks"
  3.         local in_hud    "../../../drive/raw_data/hud_crosswalks"
  4.     local temp      "../temp"
  5.     local outstub   "../../../drive/base_large/census_block_master"
  6.     local logfile   "../output/data_file_manifest.log"
  7.     
.     clean_zcta_tract_xwalk, instub(`in_xwalk')
  8.     save_data "`temp'/tract_to_zcta.dta", log(none) ///
>         key(statefips countyfips census_tract) replace 
  9.     
.     clean_zcta_cbsa_xwalk, instub(`in_xwalk')
 10.     save_data "`temp'/zcta_to_cbsa.dta", log(none) ///
>         key(zcta) replace 
 11.                 
.     clean_tract_usps_zip_xwalk, instub(`in_hud')
 12.     save_data "`temp'/tract_to_usps_zip.dta", log(none) ///
>         key(statefips countyfips census_tract) replace 
 13.     
.     use "`in_shp'/census_blocks_2010_centroids_coord.dta", clear
 14.     rename _ID     cb_centroid_geo_id
 15.     rename (_X _Y) (longitude latitude)
 16.     
.     merge m:1 cb_centroid_geo_id using "`in_shp'/census_blocks_2010_centroids
> _db.dta", ///
>         keep(1 3) nogen
 17.     rename (statfps   cntyfps    cnss_tr      cnss_bl      nm_hs10     cnt
> _wn_          ) ///
>            (statefips countyfips census_tract census_block num_house10 centro
> id_own_poly)
 18.     replace countyfips = statefips + countyfips
 19.     
.     map_to_usps_zipcode, instub(`in_shp')    
 20.     map_to_place,        instub(`in_shp')
 21.     drop latitude longitude 
 22. 
.     merge m:1 statefips countyfips census_tract using "`temp'/tract_to_zcta.d
> ta", ///
>         keep(1 3) nogen
 23.     merge m:1 zcta using "`temp'/zcta_to_cbsa.dta", ///
>         keep(1 3) nogen
 24.     merge m:1 statefips countyfips census_tract using "`temp'/tract_to_usp
> s_zip.dta", ///
>         keep(1 3) nogen
 25. 
.         gen missing_zipcode = (missing(zipcode))
 26.         replace zipcode = zipcode_hud if missing_zipcode == 1
 27.     
.     gen rural = (missing(place_code))
 28. 
.     save_data "`outstub'/census_block_master.dta", log(`logfile') ///
>         key(census_block) replace
 29.     export delimited "`outstub'/census_block_master.csv", replace
 30. end

. 
. program clean_zcta_tract_xwalk
  1.     syntax, instub(str)
  2.     
.     import delimited "`instub'/zcta_census_tract.txt", ///
>         clear stringcols(1 2 3 4 5)
  3. 
.     gen  neg_hupt = -hupt
  4.     bysort state county tract (neg_hupt): keep if _n == 1
  5.     drop neg_hupt
  6.     
.     keep state county zcta5 tract
  7.     replace county = state + county
  8.     rename (state     county     zcta5 tract       ) ///
>            (statefips countyfips zcta  census_tract)  
  9. end

. 
. program clean_zcta_cbsa_xwalk
  1.     syntax, instub(str)
  2.     
.     import delimited "`instub'/zcta_cbsa.txt", ///
>         clear stringcols(1 2)
  3. 
.     gen  neg_hupt = -hupt
  4.     bysort zcta (neg_hupt): keep if _n == 1
  5.     drop neg_hupt
  6.     
.     keep zcta5 cbsa
  7.     rename (zcta5 cbsa) ///
>            (zcta  cbsa10)  
  8. end

. 
. program clean_tract_usps_zip_xwalk
  1.     syntax, instub(str)
  2.     
.     import excel "`instub'/TRACT_ZIP_032010.xlsx", ///
>         firstrow clear
  3.     keep TRACT ZIP RES_RATIO
  4.     rename (TRACT ZIP RES_RATIO) ///
>             (census_tract zipcode_hud res_ratio) 
  5.                    
.     gen neg_res_ratio = -res_ratio
  6.     bysort census_tract (neg_res_ratio): keep if _n == 1
  7.     drop neg_res_ratio res_ratio
  8.         
.         gen statefips = substr(census_tract, 1, 2) 
  9.         gen countyfips = substr(census_tract, 1, 5) 
 10.         replace census_tract = substr(census_tract, 6, .)
 11. end

. 
. program map_to_usps_zipcode
  1.     syntax, instub(str)
  2. 
.     geoinpoly latitude longitude ///
>         using "`instub'/USPS_zipcodes_July2020_coord.dta"
  3.     rename _ID usps_zip_poly_geo_id
  4. 
.     merge m:1 usps_zip_poly_geo_id using "`instub'/USPS_zipcodes_July2020_db.
> dta", ///
>         keep(1 3) nogen keepusing(ZIP_CODE)
  5.     rename ZIP_CODE zipcode
  6. 
.     drop usps_zip_poly_geo_id cb_centroid_geo_id
  7. end

. 
. program map_to_place
  1.     syntax, instub(str)
  2. 
.     geoinpoly latitude longitude ///
>         using "`instub'/us_places_2010_coord.dta"
  3.     rename _ID us_place_poly_geo_id
  4. 
.     merge m:1 us_place_poly_geo_id using "`instub'/us_places_2010_db.dta", //
> /
>         keep(1 3) nogen keepusing(place_code place_name place_type)
  5. 
.     drop us_place_poly_geo_id
  6. end

. 
. 
. main
(25 vars, 148,897 obs)
(75,301 observations deleted)
variable county was str3 now str5
(73,596 real changes made)
(data now sorted by statefips countyfips census_tract)
  (0 bytes saved)
===============================================================================
File: ../temp/tract_to_zcta.dta
Key: statefips countyfips census_tract
===============================================================================
  73596:4(116560):786098208:698911353

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |          0
  countyfips |          0
census_tract |          0
        zcta |          0




(note: file ../temp/tract_to_zcta.dta not found)
file ../temp/tract_to_zcta.dta saved
(23 vars, 28,712 obs)
(3,053 observations deleted)
(data already sorted by zcta)
  (0 bytes saved)
===============================================================================
File: ../temp/zcta_to_cbsa.dta
Key: zcta
===============================================================================
  25659:2(99802):546899890:3368053907

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        zcta |          0
      cbsa10 |          0




(note: file ../temp/zcta_to_cbsa.dta not found)
file ../temp/zcta_to_cbsa.dta saved
(79,874 observations deleted)
(65,755 real changes made)
(data now sorted by statefips countyfips census_tract)
  variable census_tract was str11 now str6
  (328,775 bytes saved)
===============================================================================
File: ../temp/tract_to_usps_zip.dta
Key: statefips countyfips census_tract
===============================================================================
  65755:4(33751):1531179970:1678936360

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   statefips |          0
  countyfips |          0
census_tract |          0
 zipcode_hud |          0




(note: file ../temp/tract_to_usps_zip.dta not found)
file ../temp/tract_to_usps_zip.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                        11,078,297  
    -----------------------------------------
variable countyfips was str3 now str5
(11,078,297 real changes made)

    Result                           # of obs.
    -----------------------------------------
    not matched                        40,307
        from master                    40,307  
        from using                          0  

    matched                        11,037,990  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                     5,667,062
        from master                 5,667,062  
        from using                          0  

    matched                         5,411,235  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,743
        from master                     9,743  
        from using                          0  

    matched                        11,068,554  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                     1,998,312
        from master                 1,998,312  
        from using                          0  

    matched                         9,079,985  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                     3,436,016
        from master                 3,436,016  
        from using                          0  

    matched                         7,642,281  
    -----------------------------------------
(23,147 real changes made)
(data now sorted by census_block)
  variable missing_zipcode was float now byte
  variable rural was float now byte
  (66,469,782 bytes saved)
===============================================================================
File: ../../../drive/base_large/census_block_master/census_block_master.dta
Key: census_block
===============================================================================
  11078297:16(86175):1397594859:1719202632

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
census_block |          0
   statefips |          0
  countyfips |          0
census_tract |          0
 num_house10 | 11,078,297    11.88854    33.80024          0       4022
-------------+---------------------------------------------------------
       pop10 | 11,078,297     27.8694    78.59192          0      19352
centroid_o~y | 11,078,297    .9506572    .2165827          0          1
     zipcode |          0
  place_code |          0
  place_name |          0
-------------+---------------------------------------------------------
  place_type |          0
        zcta |          0
      cbsa10 |          0
 zipcode_hud |          0
missing_zi~e | 11,078,297    .0036384    .0602091          0          1
-------------+---------------------------------------------------------
       rural | 11,078,297    .5115463    .4998667          0          1




(note: file ../../../drive/base_large/census_block_master/census_block_master.d
> ta not found)
file ../../../drive/base_large/census_block_master/census_block_master.dta save
> d
(note: file ../../../drive/base_large/census_block_master/census_block_master.c
> sv not found)
file ../../../drive/base_large/census_block_master/census_block_master.csv save
> d

. 
end of do-file

 make.py ended: 2022-02-28 07:32:43
