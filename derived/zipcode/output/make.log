
 make.py started: 2022-03-07 09:04:47 C:\Users\diegog\Desktop\Diego\min_wage_rent\derived\zipcode\code 




Execute:  StataMP-64 /e do "./make_cross.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 32-core Stata perpetual license:
       Serial number:  501506205566
         Licensed to:  KU Leuven FEB (CES)
                       KU Leuven

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.


running c:\ado\personal\profile.do ...

. do ./make_cross.do 

. set more off

. clear all

. adopath + ../../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../lib/stata/gslab_misc/ado"

. 
. program main
  1.     local in_geo        "../../../drive/base_large/zipcode_master"
  2.     local in_zillow     "../../../drive/base_large/zillow"
  3.     local in_lodes_zip  "../../../drive/base_large/lodes_zipcodes"
  4.     local in_demo       "../../../drive/derived_large/demographics_at_base
> line"
  5.     local in_shares_od  "../../../drive/derived_large/od_shares"
  6.     local outstub       "../../../drive/derived_large/zipcode"
  7.     local logfile       "../output/data_file_manifest.log"
  8. 
.     build_zillow_zipcode_stats, instub(`in_zillow')
  9. 
.     use `in_geo'/zipcode_master.dta, clear
 10. 
.     merge 1:1 zipcode using "../temp/zillow_zipcodes_with_rents.dta"
 11.     drop if _merge == 2 // 6 observations from using
 12.     drop _merge
 13. 
.     merge 1:1 zipcode using "`in_demo'/zipcode.dta", ///
>         nogen keep(1 3)
 14. 
.     merge_lodes_shares, instub(`in_lodes_zip')
 15.     merge_lodes_shares, instub(`in_lodes_zip') yy(2017)
 16.     merge_od_shares,    instub(`in_shares_od')
 17. 
.     strcompress
 18.     save_data "`outstub'/zipcode_cross.dta",                              
>     ///
>         key(zipcode) log(`logfile') replace
 19.     export delimited "`outstub'/zipcode_cross.csv", replace
 20. end

. 
. program build_zillow_zipcode_stats
  1.     syntax, instub(str)
  2. 
.     use "`instub'/zillow_zipcode_clean.dta"
  3. 
.     keep if !missing(medrentpricepsqft_SFCC)
  4.     collapse (count) n_months_zillow_rents = medrentpricepsqft_SFCC, by(zi
> pcode)
  5.     tostring zipcode, format(%05.0f) replace
  6. 
.     save "../temp/zillow_zipcodes_with_rents.dta", replace
  7. end

. 
. program merge_lodes_shares
  1.     syntax, instub(str) [yy(int 2013)]
  2. 
.     preserve
  3.         use "`instub'/jobs.dta" if jobs_by == "residence" & year == `yy', 
> clear
  4.         
.         keep zipcode share_age_* share_earn_* share_naics_* share_sch_*
  5.         rename share_age_* sh_residents_*_`yy'
  6.         rename share_earn_* sh_residents_*_`yy'
  7.         rename share_naics_* sh_residents_*_`yy'
  8.         rename share_sch_* sh_residents_*_`yy'
  9.         
.         save "../temp/residents_shares.dta", replace
 10.     restore
 11.     
.     preserve
 12.         use "`instub'/jobs.dta" if jobs_by == "workplace" & year == `yy', 
> clear
 13.         
.         keep zipcode share_age_* share_earn_* share_naics_* share_sch_*
 14.         rename share_age_* sh_workers_*_`yy'
 15.         rename share_earn_* sh_workers_*_`yy'
 16.         rename share_naics_* sh_workers_*_`yy'
 17.         rename share_sch_* sh_workers_*_`yy'
 18.         
.         save "../temp/workers_shares.dta", replace
 19.     restore
 20. 
.     merge 1:1 zipcode using "../temp/residents_shares.dta", nogen keep(1 3)
 21.     merge 1:1 zipcode using "../temp/workers_shares.dta", nogen keep(1 3)
 22. end

. 
. program merge_od_shares
  1.     syntax, instub(str)
  2. 
.     foreach yy in 2013 2017 {
  3.         preserve
  4.             clear
  5.             import delimited "`instub'/zipcode_shares.csv", stringcols(1)
  6. 
.             keep if year == `yy'
  7. 
.             keep zipcode sh_*
  8.             rename sh_workers_*      sh_od_workers_*_`yy'
  9.             rename sh_residents_*    sh_od_residents_*_`yy'
 10.             rename sh_work_samegeo_* sh_od_work_samegeo_*_`yy'
 11. 
.             save "../temp/od_shares_`yy'.dta"
 12.         restore
 13.     }
 14.     merge 1:1 zipcode using "../temp/od_shares_2013.dta", nogen keep(1 3)
 15.     merge 1:1 zipcode using "../temp/od_shares_2017.dta", nogen keep(1 3)
 16. end

. 
. 
. main
(9,066,669 observations deleted)
zipcode already string; no replace
(note: file ../temp/zillow_zipcodes_with_rents.dta not found)
file ../temp/zillow_zipcodes_with_rents.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                        28,450
        from master                    28,444  (_merge==1)
        from using                          6  (_merge==2)

    matched                             3,310  (_merge==3)
    -----------------------------------------
(6 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            31,754  
    -----------------------------------------
(note: file ../temp/residents_shares.dta not found)
file ../temp/residents_shares.dta saved
(note: file ../temp/workers_shares.dta not found)
file ../temp/workers_shares.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                           229
        from master                       229  
        from using                          0  

    matched                            31,525  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,064
        from master                     1,064  
        from using                          0  

    matched                            30,690  
    -----------------------------------------
file ../temp/residents_shares.dta saved
file ../temp/workers_shares.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                           293
        from master                       293  
        from using                          0  

    matched                            31,461  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,088
        from master                     1,088  
        from using                          0  

    matched                            30,666  
    -----------------------------------------
(18 vars, 307,523 obs)
(276,832 observations deleted)
file ../temp/od_shares_2013.dta saved
(18 vars, 307,523 obs)
(276,682 observations deleted)
file ../temp/od_shares_2017.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,345
        from master                     3,345  
        from using                          0  

    matched                            28,409  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,202
        from master                     3,202  
        from using                          0  

    matched                            28,552  
    -----------------------------------------
  Converting str to strL: zipcode tract place_code countyfips statefips cbsa
    strcompress grew data 54% so far, but I'm not done yet!
  variable n_months_zillow_rents was long now int
  variable population_acs2011 was double now long
  variable n_workers_acs2011 was double now long
  variable n_mw_wkrs_statutory was double now int
  variable n_mw_wkrs_state was double now int
  variable n_mw_wkrs_fed was double now int
  variable zipcode was strL now str5
  variable tract was strL now str11
  variable place_code was strL now str7
  variable countyfips was strL now str5
  variable statefips was strL now str2
  variable cbsa was strL now str5
  (15,449,040 bytes saved)
       compress shrank data 38%
    strcompress shrank data  4% overall
(data already sorted by zipcode)
  (0 bytes saved)
===============================================================================
File: ../../../drive/derived_large/zipcode/zipcode_cross.dta
Key: zipcode
===============================================================================
  31754:109(72375):1924777388:686633686

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     zipcode |          0
n_census_b~s |     31,754    347.5475    355.8447          1       9067
n_blockgro~s |     31,754    10.52548    11.06104          1        101
    n_tracts |     31,754    5.116584    4.594125          1         47
    n_places |     31,754    2.567173    1.694982          1         81
-------------+---------------------------------------------------------
  n_counties |     31,754    1.451943    .7022054          1          7
      n_cbsa |     31,754     1.24863    .5041342          1          5
    n_states |     31,754    1.015715    .1243708          1          2
  num_houses |     31,754    4132.686    5588.503          0      48073
  population |     31,754    9689.449    13768.12          0     115182
-------------+---------------------------------------------------------
    sh_rural |     31,754    .5669182    .3566124          0          1
share_rura~s |     31,496    .4788689    .3638109          0          1
       tract |          0
  place_code |          0
  countyfips |          0
-------------+---------------------------------------------------------
   statefips |          0
        cbsa |          0
n_months_z~s |      3,310    59.74653    34.21764         12        119
populat~2010 |     31,754      9670.5    13755.56          0     115182
n_male_~2010 |     31,754    4754.675    6726.825          0      57965
-------------+---------------------------------------------------------
n_white~2010 |     31,754    7005.537    9522.777          0      91407
n_black~2010 |     31,754    1214.418    3814.809          0      79984
urb_pop~2010 |     31,526    .3902312     .436533          0          1
n_hhlds_ce~0 |     31,754    4123.342     5579.89          0      48073
n_hhlds_ur~0 |     31,754     3252.98    5558.294          0      48073
-------------+---------------------------------------------------------
n_hhlds_re~0 |     31,754    1272.652    2373.331          0      33601
populat~2011 |     31,138    9392.638    13416.43          0     114694
n_worke~2011 |     31,138    4273.722    6232.801          0      51551
n_mw_wkrs_~y |     31,138    704.6712     1056.28          0      11010
n_mw_wkrs_~e |     31,138    704.0669    1054.597          0      11010
-------------+---------------------------------------------------------
n_mw_wkrs_~d |     31,138    679.9902    1007.934          0      10539
med_hhl~2011 |     31,091    28653.62    24371.36          9   225461.9
sh_whit~2010 |     31,526    .8343495    .2033685          0          1
sh_blac~2010 |     31,526     .075431    .1552383          0          1
sh_male~2010 |     31,526    .5017685    .0423758          0          1
-------------+---------------------------------------------------------
sh_hhlds_u~0 |     31,469    .3865303     .435426          0          1
sh_hhlds_r~0 |     31,469    .2239473    .1448237          0          1
sh_mw_wkrs~y |     30,893    .1779022    .0619203          0          1
sh_mw_wkrs~e |     30,893    .1778632    .0619268          0          1
sh_mw_wkrs~d |     30,893    .1732508    .0608261          0          1
-------------+---------------------------------------------------------
sh_re~9_2013 |     31,525    .2155109    .0463283          0          1
sh_re~4_2013 |     31,525    .5475469    .0511595          0          1
sh_re~5_2013 |     31,525    .2369423    .0527434          0          1
sh_re~0_2013 |     31,525    .2637964    .0570151          0          1
sh_residen.. |     31,525      .37381    .0805444          0          1
-------------+---------------------------------------------------------
sh_residen.. |     31,525    .3623936    .1052688          0          1
sh_re~S_2013 |     31,525    .0877537    .0394757          0          1
sh_residen.. |     31,525    .2392554    .0544072          0          1
sh_residen.. |     31,525     .258164    .0401288          0          1
sh_r~ge_2013 |     31,525    .1993161    .0658336          0          1
-------------+---------------------------------------------------------
sh_re~f_2013 |     31,525     .110037    .0692522          0   .6666667
sh_r~il_2013 |     31,525    .1137373     .033362          0          1
sh_r~ce_2013 |     31,525    .0354768    .0220869          0          1
sh_re~d_2013 |     31,525    .0841938    .0392197          0          1
sh_wo~9_2013 |     30,690    .2117331    .0887548          0          1
-------------+---------------------------------------------------------
sh_wo~4_2013 |     30,690    .5410068    .0944153          0          1
sh_wo~5_2013 |     30,690    .2472601    .0949416          0          1
sh_wo~0_2013 |     30,690    .3045655    .1430045          0          1
sh_workers.. |     30,690    .3828809    .1259594          0          1
sh_workers.. |     30,690    .3125536     .158678          0          1
-------------+---------------------------------------------------------
sh_wo~S_2013 |     30,690    .0989907    .0611337          0          1
sh_workers.. |     30,690    .2571335    .0910076          0          1
sh_workers.. |     30,690    .2538699    .0731362          0          1
sh_w~ge_2013 |     30,690    .1782728    .0844395          0          1
sh_wo~f_2013 |     30,690    .0984537    .1546521          0          1
-------------+---------------------------------------------------------
sh_w~il_2013 |     30,690    .1101112    .1185639          0          1
sh_w~ce_2013 |     30,690    .0269048    .0559317          0          1
sh_wo~d_2013 |     30,690    .0831952    .1169617          0          1
sh_re~9_2017 |     31,461    .2239533    .0480714          0          1
sh_re~4_2017 |     31,461    .5230963    .0548647          0          1
-------------+---------------------------------------------------------
sh_re~5_2017 |     31,461    .2529504    .0579569          0          1
sh_re~0_2017 |     31,461    .2436352    .0562265          0          1
sh_residen.. |     31,461    .3497791    .0811216          0          1
sh_residen.. |     31,461    .4065857    .1058888          0          1
sh_re~S_2017 |     31,461    .0897694    .0405529          0          1
-------------+---------------------------------------------------------
sh_residen.. |     31,461    .2324174    .0539222          0          1
sh_residen.. |     31,461    .2549507    .0461686          0          1
sh_r~ge_2017 |     31,461    .1989093    .0664303          0          1
sh_re~f_2017 |     31,461    .1058928    .0680609          0          1
sh_r~il_2017 |     31,461    .1155512    .0339366          0          1
-------------+---------------------------------------------------------
sh_r~ce_2017 |     31,461     .034819    .0214578          0         .5
sh_re~d_2017 |     31,461    .0879157    .0421463          0          1
sh_wo~9_2017 |     30,666    .2153773    .0868517          0          1
sh_wo~4_2017 |     30,666    .5157951    .0944855          0          1
sh_wo~5_2017 |     30,666    .2688275    .0998757          0          1
-------------+---------------------------------------------------------
sh_wo~0_2017 |     30,666    .2814725    .1360906          0          1
sh_workers.. |     30,666    .3643202    .1210529          0          1
sh_workers.. |     30,666    .3542072    .1596063          0          1
sh_wo~S_2017 |     30,666    .1009035    .0612298          0          1
sh_workers.. |     30,666    .2524793    .0910505          0          1
-------------+---------------------------------------------------------
sh_workers.. |     30,666    .2526679    .0757664          0          1
sh_w~ge_2017 |     30,666    .1785719    .0846128          0          1
sh_wo~f_2017 |     30,666     .095633    .1515886          0          1
sh_w~il_2017 |     30,666    .1087676    .1188049          0          1
sh_w~ce_2017 |     30,666    .0250798    .0561774          0          1
-------------+---------------------------------------------------------
sh_wo~d_2017 |     30,666    .0864241    .1194999          0          1
sh_od_resi.. |     28,315    .2167511    .0418894          0          1
sh_od_resi.. |     28,315    .2645485    .0517039          0          1
sh_od_work.. |     28,409    .2118967    .0896337          0          1
sh_od_work.. |     28,409    .3055653     .144561          0          1
-------------+---------------------------------------------------------
sh_work_sa~o |     25,183    .0937512    .1126374   .0000654   .9689469
sh_od_work.. |     25,183    .0194602    .0249504          0   .3157895
sh_od_work.. |     25,183    .0298169    .0347918          0   .4063906
sh_od_resi.. |     28,459    .2249558    .0411933          0   .7762431
sh_od_resi.. |     28,459    .2446625    .0496942          0          1
-------------+---------------------------------------------------------
sh_od_work.. |     28,552    .2156809    .0881261          0          1
sh_od_work.. |     28,552    .2823061    .1376731          0          1
sh_od_work.. |     25,558    .0207179    .0262189          0   .3162583
sh_od_work.. |     25,558    .0289737    .0337253          0   .3595969




(note: file ../../../drive/derived_large/zipcode/zipcode_cross.dta not found)
file ../../../drive/derived_large/zipcode/zipcode_cross.dta saved
(note: file ../../../drive/derived_large/zipcode/zipcode_cross.csv not found)
file ../../../drive/derived_large/zipcode/zipcode_cross.csv saved

. 
end of do-file

 make.py ended: 2022-03-07 09:05:21
