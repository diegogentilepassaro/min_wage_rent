
 make.py started: 2022-03-26 11:32:37 C:\Users\shermo\Documents\GitHub\min_wage_rent\derived\zipcode\code 




Execute:  StataMP-64 /e do "./build.do"

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 32-core Stata perpetual license:
       Serial number:  501506205566
         Licensed to:  KU Leuven FEB (CES)
                       KU Leuven

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.


running c:\ado\personal\profile.do ...

. do ./build.do 

. set more off

. clear all

. adopath + ../../../lib/stata/gslab_misc/ado
  [1]  (BASE)      "C:\Program Files\Stata15\ado\base/"
  [2]  (SITE)      "C:\Program Files\Stata15\ado\site/"
  [3]              "."
  [4]  (PERSONAL)  "c:\ado\personal/"
  [5]  (PLUS)      "c:\ado\plus/"
  [6]  (OLDPLACE)  "c:\ado/"
  [7]              "../../../lib/stata/gslab_misc/ado"

. 
. program main
  1.     local in_geo        "../../../drive/base_large/zipcode_master"
  2.     local in_zillow     "../../../drive/base_large/zillow"
  3.     local in_lodes_zip  "../../../drive/base_large/lodes_zipcodes"
  4.     local in_demo       "../../../drive/derived_large/demographics_at_base
> line"
  5.     local in_shares_od  "../../../drive/derived_large/od_shares"
  6.     local outstub       "../../../drive/derived_large/zipcode"
  7.     local logfile       "../output/data_file_manifest.log"
  8. 
.     build_zillow_zipcode_stats, instub(`in_zillow')
  9. 
.     use `in_geo'/zipcode_master.dta, clear
 10. 
.     merge 1:1 zipcode using "../temp/zillow_zipcodes_with_rents.dta"
 11.     drop if _merge == 2 // 6 observations from using
 12.     drop _merge
 13. 
.     merge 1:1 zipcode using "`in_demo'/zipcode.dta", ///
>         nogen keep(1 3)
 14. 
.     generate_urban_flags
 15. 
.     merge_lodes_shares, instub(`in_lodes_zip')
 16.     merge_lodes_shares, instub(`in_lodes_zip') yy(2017)
 17.     merge_od_shares,    instub(`in_shares_od')
 18. 
.     strcompress
 19.     save_data "`outstub'/zipcode_cross.dta",                              
>     ///
>         key(zipcode) log(`logfile') replace
 20.     export delimited "`outstub'/zipcode_cross.csv", replace
 21. end

. 
. program build_zillow_zipcode_stats
  1.     syntax, instub(str)
  2. 
.     use "`instub'/zillow_zipcode_clean.dta"
  3. 
.     keep if !missing(medrentpricepsqft_SFCC)
  4.     collapse (count) n_months_zillow_rents = medrentpricepsqft_SFCC, by(zi
> pcode)
  5.     tostring zipcode, format(%05.0f) replace
  6. 
.     save "../temp/zillow_zipcodes_with_rents.dta", replace
  7. end

. 
. program generate_urban_flags
  1.     syntax, [urban_thresh(real 0.8)]
  2. 
.     preserve
  3.         collapse (sum) urb_pop_cens2010 population_cens2010, ///
>             by(cbsa)
  4. 
.         gen share_urban_pop_2010 = urb_pop_cens2010/population_cens2010
  5. 
.         gen  urban_cbsa = (share_urban_pop_2010 >= `urban_thresh')
  6. 
.         keep cbsa urban_cbsa
  7.         tempfile cbsa_data
  8.         save    `cbsa_data'
  9.     restore
 10. 
.     merge m:1 cbsa using `cbsa_data', assert(3) nogen
 11. 
.     gen urban_zip = (sh_urb_pop_cens2010 >= `urban_thresh')
 12. end

. 
. program merge_lodes_shares
  1.     syntax, instub(str) [yy(int 2013)]
  2. 
.     preserve
  3.         use "`instub'/jobs.dta" if jobs_by == "residence" & year == `yy', 
> clear
  4.         
.         keep zipcode share_age_* share_earn_* share_naics_* share_sch_*
  5.         rename share_age_* sh_residents_*_`yy'
  6.         rename share_earn_* sh_residents_*_`yy'
  7.         rename share_naics_* sh_residents_*_`yy'
  8.         rename share_sch_* sh_residents_*_`yy'
  9.         
.         save "../temp/residents_shares.dta", replace
 10.     restore
 11.     
.     preserve
 12.         use "`instub'/jobs.dta" if jobs_by == "workplace" & year == `yy', 
> clear
 13.         
.         keep zipcode share_age_* share_earn_* share_naics_* share_sch_*
 14.         rename share_age_* sh_workers_*_`yy'
 15.         rename share_earn_* sh_workers_*_`yy'
 16.         rename share_naics_* sh_workers_*_`yy'
 17.         rename share_sch_* sh_workers_*_`yy'
 18.         
.         save "../temp/workers_shares.dta", replace
 19.     restore
 20. 
.     merge 1:1 zipcode using "../temp/residents_shares.dta", nogen keep(1 3)
 21.     merge 1:1 zipcode using "../temp/workers_shares.dta", nogen keep(1 3)
 22. end

. 
. program merge_od_shares
  1.     syntax, instub(str)
  2. 
.     foreach yy in 2013 2017 {
  3.         preserve
  4.             clear
  5.             import delimited "`instub'/zipcode_shares.csv", stringcols(1)
  6. 
.             keep if year == `yy'
  7. 
.             keep zipcode sh_*
  8.             rename sh_workers_*      sh_od_workers_*_`yy'
  9.             rename sh_residents_*    sh_od_residents_*_`yy'
 10.             rename sh_work_samegeo_* sh_od_work_samegeo_*_`yy'
 11. 
.             save "../temp/od_shares_`yy'.dta"
 12.         restore
 13.     }
 14.     merge 1:1 zipcode using "../temp/od_shares_2013.dta", nogen keep(1 3)
 15.     merge 1:1 zipcode using "../temp/od_shares_2017.dta", nogen keep(1 3)
 16. end

. 
. 
. main
(9,066,669 observations deleted)
zipcode already string; no replace
(note: file ../temp/zillow_zipcodes_with_rents.dta not found)
file ../temp/zillow_zipcodes_with_rents.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                        28,510
        from master                    28,510  (_merge==1)
        from using                          0  (_merge==2)

    matched                             3,316  (_merge==3)
    -----------------------------------------
(0 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            31,826  
    -----------------------------------------
file C:\Users\shermo\AppData\Local\Temp\8\ST_69e84_000002.tmp saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            31,826  
    -----------------------------------------
(note: file ../temp/residents_shares.dta not found)
file ../temp/residents_shares.dta saved
(note: file ../temp/workers_shares.dta not found)
file ../temp/workers_shares.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                           223
        from master                       223  
        from using                          0  

    matched                            31,603  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,056
        from master                     1,056  
        from using                          0  

    matched                            30,770  
    -----------------------------------------
file ../temp/residents_shares.dta saved
file ../temp/workers_shares.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                           287
        from master                       287  
        from using                          0  

    matched                            31,539  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,081
        from master                     1,081  
        from using                          0  

    matched                            30,745  
    -----------------------------------------
(18 vars, 308,321 obs)
(277,550 observations deleted)
file ../temp/od_shares_2013.dta saved
(18 vars, 308,321 obs)
(277,401 observations deleted)
file ../temp/od_shares_2017.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,417
        from master                     3,417  
        from using                          0  

    matched                            28,409  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,274
        from master                     3,274  
        from using                          0  

    matched                            28,552  
    -----------------------------------------
  Converting str to strL: zipcode tract place_code countyfips statefips cbsa
    strcompress grew data 52% so far, but I'm not done yet!
  variable n_months_zillow_rents was long now int
  variable rural_pop_cens2010 was long now int
  variable urban_cbsa was float now byte
  variable urban_zip was float now byte
  variable population_acs2011 was double now long
  variable n_workers_acs2011 was double now long
  variable n_mw_wkrs_statutory was double now int
  variable n_mw_wkrs_state was double now int
  variable n_mw_wkrs_fed was double now int
  variable zipcode was strL now str5
  variable tract was strL now str11
  variable place_code was strL now str7
  variable countyfips was strL now str5
  variable statefips was strL now str2
  variable cbsa was strL now str5
  (15,678,419 bytes saved)
       compress shrank data 38%
    strcompress shrank data  5% overall
(data already sorted by zipcode)
  (0 bytes saved)
===============================================================================
File: ../../../drive/derived_large/zipcode/zipcode_cross.dta
Key: zipcode
===============================================================================
  31826:114(30601):3313320843:1042624407

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     zipcode |          0
n_census_b~s |     31,826    347.5485    355.6261          1       9067
n_blockgro~s |     31,826    10.53764    11.06662          1        101
    n_tracts |     31,826    5.120656    4.595078          1         47
    n_places |     31,826    2.566864       1.694          1         81
-------------+---------------------------------------------------------
  n_counties |     31,826    1.451643     .701879          1          7
      n_cbsa |     31,826    1.248288    .5038121          1          5
    n_states |     31,826    1.016119    .1259348          1          2
  num_houses |     31,826    4137.897    5588.921          0      48073
  population |     31,826    9700.601    13766.08          0     115182
-------------+---------------------------------------------------------
    sh_rural |     31,826    .5668876    .3567429          0          1
sh_rural_w~s |     31,574    .4790736     .363997          0          1
       tract |          0
  place_code |          0
  countyfips |          0
-------------+---------------------------------------------------------
   statefips |          0
        cbsa |          0
n_months_z~s |      3,316    59.70386    34.21254         12        119
populat~2010 |     31,826    9681.695    13753.56          0     115182
n_male_~2010 |     31,826    4759.893    6725.643          0      57965
-------------+---------------------------------------------------------
n_white~2010 |     31,826    7016.612    9524.533          0      91407
n_black~2010 |     31,826    1213.561    3811.352          0      79984
urb_pop~2010 |     31,826    7812.452    13652.63          0     115182
n_hhlds_ce~0 |     31,826    4128.574    5580.337          0      48073
n_hhlds_ur~0 |     31,826    3258.792    5559.654          0      48073
-------------+---------------------------------------------------------
n_hhlds_re~0 |     31,826    1274.883    2374.503          0      33601
rural_p~2010 |     31,826    1869.243    2541.051          0      26907
populat~2011 |     31,212    9404.425    13415.51          0     114694
n_worke~2011 |     31,212    4279.787     6232.33          0      51551
n_mw_wkrs_~y |     31,212    705.6674     1056.35          0      11010
-------------+---------------------------------------------------------
n_mw_wkrs_~e |     31,212    705.0645    1054.671          0      11010
n_mw_wkrs_~d |     31,212    680.9874    1008.076          0      10539
med_hhl~2011 |     31,168       28689    24386.72          9   225461.9
sh_whit~2010 |     31,604    .8344599    .2032514          0          1
sh_blac~2010 |     31,604    .0753265    .1550807          0          1
-------------+---------------------------------------------------------
sh_male~2010 |     31,604    .5017386    .0423811          0          1
sh_urb_~2010 |     31,604     .390969    .4367148          0          1
sh_rura~2010 |     31,604     .609031    .4367148          0          1
sh_hhlds_u~0 |     31,547    .3872851    .4356147          0          1
sh_hhlds_r~0 |     31,547    .2240798    .1448693          0          1
-------------+---------------------------------------------------------
sh_mw_wkrs~y |     30,972    .1778826    .0620079          0          1
sh_mw_wkrs~e |     30,972    .1778438    .0620143          0          1
sh_mw_wkrs~d |     30,972    .1732351    .0609171          0          1
  urban_cbsa |     31,826    .3567523    .4790483          0          1
   urban_zip |     31,826    .3105008     .462706          0          1
-------------+---------------------------------------------------------
sh_re~9_2013 |     31,603     .215515    .0462962          0          1
sh_re~4_2013 |     31,603    .5475061    .0511009          0          1
sh_re~5_2013 |     31,603    .2369789    .0527138          0          1
sh_re~0_2013 |     31,603    .2637654    .0569687          0          1
sh_residen.. |     31,603    .3736977    .0805164          0          1
-------------+---------------------------------------------------------
sh_residen.. |     31,603    .3625369    .1052486          0          1
sh_re~S_2013 |     31,603    .0877186    .0394532          0          1
sh_residen.. |     31,603    .2391548    .0543874          0          1
sh_residen.. |     31,603     .258141    .0400944          0          1
sh_r~ge_2013 |     31,603    .1994706    .0658469          0          1
-------------+---------------------------------------------------------
sh_re~f_2013 |     31,603    .1100031     .069186          0   .6666667
sh_r~il_2013 |     31,603    .1137292    .0333422          0          1
sh_r~ce_2013 |     31,603    .0355028    .0220698          0          1
sh_re~d_2013 |     31,603    .0842159    .0391991          0          1
sh_wo~9_2013 |     30,770    .2117696    .0887404          0          1
-------------+---------------------------------------------------------
sh_wo~4_2013 |     30,770    .5409905    .0943871          0          1
sh_wo~5_2013 |     30,770    .2472399    .0948825          0          1
sh_wo~0_2013 |     30,770    .3045117    .1429267          0          1
sh_workers.. |     30,770    .3827977    .1258923          0          1
sh_workers.. |     30,770    .3126905    .1586489          0          1
-------------+---------------------------------------------------------
sh_wo~S_2013 |     30,770    .0989215    .0610894          0          1
sh_workers.. |     30,770    .2570484    .0909343          0          1
sh_workers.. |     30,770    .2538444    .0730954          0          1
sh_w~ge_2013 |     30,770    .1784161    .0844473          0          1
sh_wo~f_2013 |     30,770    .0984303    .1545642          0          1
-------------+---------------------------------------------------------
sh_w~il_2013 |     30,770    .1100396    .1184553          0          1
sh_w~ce_2013 |     30,770    .0269109    .0559106          0          1
sh_wo~d_2013 |     30,770     .083209     .116872          0          1
sh_re~9_2017 |     31,539     .223932     .048058          0          1
sh_re~4_2017 |     31,539    .5230601    .0548097          0          1
-------------+---------------------------------------------------------
sh_re~5_2017 |     31,539    .2530078    .0579319          0          1
sh_re~0_2017 |     31,539    .2435743    .0561917          0          1
sh_residen.. |     31,539    .3496767     .081093          0          1
sh_residen.. |     31,539     .406749    .1058708          0          1
sh_re~S_2017 |     31,539     .089734    .0405314          0          1
-------------+---------------------------------------------------------
sh_residen.. |     31,539    .2323392     .053887          0          1
sh_residen.. |     31,539    .2549181    .0461318          0          1
sh_r~ge_2017 |     31,539    .1990766    .0664623          0          1
sh_re~f_2017 |     31,539     .105875    .0679906          0          1
sh_r~il_2017 |     31,539    .1155329    .0339016          0          1
-------------+---------------------------------------------------------
sh_r~ce_2017 |     31,539    .0348457     .021443          0         .5
sh_re~d_2017 |     31,539    .0879353    .0421151          0          1
sh_wo~9_2017 |     30,745    .2154053    .0868001          0          1
sh_wo~4_2017 |     30,745    .5157884    .0944545          0          1
sh_wo~5_2017 |     30,745    .2688063    .0997894          0          1
-------------+---------------------------------------------------------
sh_wo~0_2017 |     30,745    .2814243    .1359782          0          1
sh_workers.. |     30,745    .3642706    .1209817          0          1
sh_workers.. |     30,745    .3543051    .1595226          0          1
sh_wo~S_2017 |     30,745    .1008578    .0611871          0          1
sh_workers.. |     30,745    .2523721    .0910078          0          1
-------------+---------------------------------------------------------
sh_workers.. |     30,745    .2526431    .0756963          0          1
sh_w~ge_2017 |     30,745    .1787217    .0846085          0          1
sh_wo~f_2017 |     30,745    .0955913    .1514867          0          1
sh_w~il_2017 |     30,745    .1087085    .1186967          0          1
sh_w~ce_2017 |     30,745     .025094    .0561649          0          1
-------------+---------------------------------------------------------
sh_wo~d_2017 |     30,745    .0864658     .119429          0          1
sh_od_resi.. |     28,315    .2167551    .0418881          0          1
sh_od_resi.. |     28,315    .2645526    .0516992          0          1
sh_od_work.. |     28,409     .211905    .0896265          0          1
sh_od_work.. |     28,409    .3055705    .1445638          0          1
-------------+---------------------------------------------------------
sh_work_sa~o |     25,183    .0937492     .112636   .0000654   .9689469
sh_od_work.. |     25,183    .0194598    .0249502          0   .3157895
sh_od_work.. |     25,183    .0298162    .0347914          0   .4063906
sh_od_resi.. |     28,459    .2249602    .0411901          0   .7762431
sh_od_resi.. |     28,459    .2446687    .0496904          0          1
-------------+---------------------------------------------------------
sh_od_work.. |     28,552    .2156865    .0881378          0          1
sh_od_work.. |     28,552    .2823066    .1376744          0          1
sh_od_work.. |     25,558    .0207173    .0262185          0   .3162583
sh_od_work.. |     25,558    .0289729    .0337249          0   .3595969




(note: file ../../../drive/derived_large/zipcode/zipcode_cross.dta not found)
file ../../../drive/derived_large/zipcode/zipcode_cross.dta saved
(note: file ../../../drive/derived_large/zipcode/zipcode_cross.csv not found)
file ../../../drive/derived_large/zipcode/zipcode_cross.csv saved

. 
end of do-file

 make.py ended: 2022-03-26 11:33:29
